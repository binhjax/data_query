{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{2171:function(e,t,i){var a;!function(n,r,o){if(n){for(var s,l={8:\"backspace\",9:\"tab\",13:\"enter\",16:\"shift\",17:\"ctrl\",18:\"alt\",20:\"capslock\",27:\"esc\",32:\"space\",33:\"pageup\",34:\"pagedown\",35:\"end\",36:\"home\",37:\"left\",38:\"up\",39:\"right\",40:\"down\",45:\"ins\",46:\"del\",91:\"meta\",93:\"meta\",224:\"meta\"},u={106:\"*\",107:\"+\",109:\"-\",110:\".\",111:\"/\",186:\";\",187:\"=\",188:\",\",189:\"-\",190:\".\",191:\"/\",192:\"`\",219:\"[\",220:\"\\\\\",221:\"]\",222:\"'\"},c={\"~\":\"`\",\"!\":\"1\",\"@\":\"2\",\"#\":\"3\",$:\"4\",\"%\":\"5\",\"^\":\"6\",\"&\":\"7\",\"*\":\"8\",\"(\":\"9\",\")\":\"0\",_:\"-\",\"+\":\"=\",\":\":\";\",'\"':\"'\",\"<\":\",\",\">\":\".\",\"?\":\"/\",\"|\":\"\\\\\"},g={option:\"alt\",command:\"meta\",return:\"enter\",escape:\"esc\",plus:\"+\",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?\"meta\":\"ctrl\"},d=1;d<20;++d)l[111+d]=\"f\"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();b.prototype.bind=function(e,t,i){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,i),this},b.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},b.prototype.trigger=function(e,t){return this._directMap[e+\":\"+t]&&this._directMap[e+\":\"+t]({},e),this},b.prototype.reset=function(){return this._callbacks={},this._directMap={},this},b.prototype.stopCallback=function(e,t){if((\" \"+t.className+\" \").indexOf(\" mousetrap \")>-1)return!1;if(function e(t,i){return null!==t&&t!==r&&(t===i||e(t.parentNode,i))}(t,this.target))return!1;if(\"composedPath\"in e&&\"function\"==typeof e.composedPath){var i=e.composedPath()[0];i!==e.target&&(t=i)}return\"INPUT\"==t.tagName||\"SELECT\"==t.tagName||\"TEXTAREA\"==t.tagName||t.isContentEditable},b.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},b.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);s=null},b.init=function(){var e=b(r);for(var t in e)\"_\"!==t.charAt(0)&&(b[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},b.init(),n.Mousetrap=b,e.exports&&(e.exports=b),void 0===(a=function(){return b}.call(t,i,t,e))||(e.exports=a)}function h(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent(\"on\"+t,i)}function f(e){if(\"keypress\"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return l[e.which]?l[e.which]:u[e.which]?u[e.which]:String.fromCharCode(e.which).toLowerCase()}function p(e){return\"shift\"==e||\"ctrl\"==e||\"alt\"==e||\"meta\"==e}function v(e,t,i){return i||(i=function(){if(!s)for(var e in s={},l)e>95&&e<112||l.hasOwnProperty(e)&&(s[l[e]]=e);return s}()[e]?\"keydown\":\"keypress\"),\"keypress\"==i&&t.length&&(i=\"keydown\"),i}function m(e,t){var i,a,n,r=[];for(i=function(e){return\"+\"===e?[\"+\"]:(e=e.replace(/\\+{2}/g,\"+plus\")).split(\"+\")}(e),n=0;n<i.length;++n)a=i[n],g[a]&&(a=g[a]),t&&\"keypress\"!=t&&c[a]&&(a=c[a],r.push(\"shift\")),p(a)&&r.push(a);return{key:a,modifiers:r,action:t=v(a,r,t)}}function b(e){var t=this;if(e=e||r,!(t instanceof b))return new b(e);t.target=e,t._callbacks={},t._directMap={};var i,a={},n=!1,o=!1,s=!1;function l(e){e=e||{};var t,i=!1;for(t in a)e[t]?i=!0:a[t]=0;i||(s=!1)}function u(e,i,n,r,o,s){var l,u,c,g,d=[],h=n.type;if(!t._callbacks[e])return[];for(\"keyup\"==h&&p(e)&&(i=[e]),l=0;l<t._callbacks[e].length;++l)if(u=t._callbacks[e][l],(r||!u.seq||a[u.seq]==u.level)&&h==u.action&&(\"keypress\"==h&&!n.metaKey&&!n.ctrlKey||(c=i,g=u.modifiers,c.sort().join(\",\")===g.sort().join(\",\")))){var f=!r&&u.combo==o,v=r&&u.seq==r&&u.level==s;(f||v)&&t._callbacks[e].splice(l,1),d.push(u)}return d}function c(e,i,a,n){t.stopCallback(i,i.target||i.srcElement,a,n)||!1===e(i,a)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(i),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(i))}function g(e){\"number\"!=typeof e.which&&(e.which=e.keyCode);var i=f(e);i&&(\"keyup\"!=e.type||n!==i?t.handleKey(i,function(e){var t=[];return e.shiftKey&&t.push(\"shift\"),e.altKey&&t.push(\"alt\"),e.ctrlKey&&t.push(\"ctrl\"),e.metaKey&&t.push(\"meta\"),t}(e),e):n=!1)}function d(e,t,r,o){function u(t){return function(){s=t,++a[e],clearTimeout(i),i=setTimeout(l,1e3)}}function g(t){c(r,t,e),\"keyup\"!==o&&(n=f(t)),setTimeout(l,10)}a[e]=0;for(var d=0;d<t.length;++d){var h=d+1===t.length?g:u(o||m(t[d+1]).action);v(t[d],h,o,e,d)}}function v(e,i,a,n,r){t._directMap[e+\":\"+a]=i;var o,s=(e=e.replace(/\\s+/g,\" \")).split(\" \");s.length>1?d(e,s,i,a):(o=m(e,a),t._callbacks[o.key]=t._callbacks[o.key]||[],u(o.key,o.modifiers,{type:o.action},n,e,r),t._callbacks[o.key][n?\"unshift\":\"push\"]({callback:i,modifiers:o.modifiers,action:o.action,seq:n,level:r,combo:e}))}t._handleKey=function(e,t,i){var a,n=u(e,t,i),r={},g=0,d=!1;for(a=0;a<n.length;++a)n[a].seq&&(g=Math.max(g,n[a].level));for(a=0;a<n.length;++a)if(n[a].seq){if(n[a].level!=g)continue;d=!0,r[n[a].seq]=1,c(n[a].callback,i,n[a].combo,n[a].seq)}else d||c(n[a].callback,i,n[a].combo);var h=\"keypress\"==i.type&&o;i.type!=s||p(e)||h||l(r),o=d&&\"keydown\"==i.type},t._bindMultiple=function(e,t,i){for(var a=0;a<e.length;++a)v(e[a],t,i)},h(e,\"keypress\",g),h(e,\"keydown\",g),h(e,\"keyup\",g)}}(\"undefined\"!=typeof window?window:null,\"undefined\"!=typeof window?document:null)},4597:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return L}));var a=i(13),n=i(7),r=i(16),o=i(17),s=i(4616);function l(e,t){var i=s.c([],t,e);return s.b(i,i,1/i[3]),i}var u=i(4598),c=i(4593),g=i(4610);function d(e,t){if(!e)throw new Error(t||\"@math.gl/web-mercator: assertion failed.\")}var h=Math.PI,f=h/4,p=h/180,v=180/h;function m(e){return Math.pow(2,e)}function b(e){var t=Object(n.a)(e,2),i=t[0],a=t[1];d(Number.isFinite(i)),d(Number.isFinite(a)&&a>=-90&&a<=90,\"invalid latitude\");var r=a*p;return[512*(i*p+h)/(2*h),512*(h+Math.log(Math.tan(f+.5*r)))/(2*h)]}function y(e){var t=Object(n.a)(e,2),i=t[0],a=t[1],r=i/512*(2*h)-h,o=2*(Math.atan(Math.exp(a/512*(2*h)-h))-f);return[r*v,o*v]}function x(e){var t=e.latitude,i=e.longitude,a=e.highPrecision,n=void 0!==a&&a;d(Number.isFinite(t)&&Number.isFinite(i));var r={},o=Math.cos(t*p),s=512/360/o,l=512/4003e4/o;if(r.unitsPerMeter=[l,l,l],r.metersPerUnit=[1/l,1/l,1/l],r.unitsPerDegree=[512/360,s,l],r.degreesPerUnit=[.703125,1/s,1/l],n){var u=p*Math.tan(t*p)/o,c=512/360*u/2,g=512/4003e4*u,h=g/s*l;r.unitsPerDegree2=[0,c,g],r.unitsPerMeter2=[h,0,h]}return r}function w(e){var t=e.height,i=e.pitch,a=e.bearing,n=e.altitude,r=e.scale,o=e.center,s=void 0===o?null:o,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u.o(l,l,[0,0,-n]),u.k(l,l,-i*p),u.m(l,l,a*p),r/=t,u.n(l,l,[r,r,r]),s&&u.o(l,l,g.d([],s)),l}function M(e){var t=e.width,i=e.height,a=e.pitch,n=function(e){var t=e.width,i=e.height,a=e.altitude,n=void 0===a?1.5:a,r=e.pitch,o=void 0===r?0:r,s=e.nearZMultiplier,l=void 0===s?1:s,u=e.farZMultiplier,c=void 0===u?1:u,g=o*p,d=Math.atan(.5/n),h=Math.sin(d)*n/Math.sin(Math.min(Math.max(Math.PI/2-g-d,.01),Math.PI-.01));return{fov:2*d,aspect:t/i,focalDistance:n,near:l,far:(Math.sin(g)*h+n)*c}}({width:t,height:i,altitude:e.altitude,pitch:a,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),r=n.fov,o=n.aspect,s=n.near,l=n.far;return u.i([],r,o,s,l)}function C(e,t){var i=Object(n.a)(e,3),a=i[0],r=i[1],o=i[2],s=void 0===o?0:o;return d(Number.isFinite(a)&&Number.isFinite(r)&&Number.isFinite(s)),l(t,[a,r,s,1])}function S(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Object(n.a)(e,3),r=a[0],o=a[1],s=a[2];if(d(Number.isFinite(r)&&Number.isFinite(o),\"invalid pixel coordinate\"),Number.isFinite(s)){var u=l(t,[r,o,s,1]);return u}var g=l(t,[r,o,0,1]),h=l(t,[r,o,1,1]),f=g[2],p=h[2],v=f===p?0:((i||0)-f)/(p-f);return c.d([],g,h,v)}function P(e){var t=e.width,i=e.height,a=e.bounds,r=e.minExtent,o=void 0===r?0:r,s=e.maxZoom,l=void 0===s?24:s,u=e.padding,c=void 0===u?0:u,g=e.offset,h=void 0===g?[0,0]:g,f=Object(n.a)(a,2),p=Object(n.a)(f[0],2),v=p[0],m=p[1],b=Object(n.a)(f[1],2),y=b[0],x=b[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else d(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var w=new A({width:t,height:i,longitude:0,latitude:0,zoom:0}),M=w.project([v,x]),C=w.project([y,m]),S=[Math.max(Math.abs(C[0]-M[0]),o),Math.max(Math.abs(C[1]-M[1]),o)],P=[t-c.left-c.right-2*Math.abs(h[0]),i-c.top-c.bottom-2*Math.abs(h[1])];d(P[0]>0&&P[1]>0);var O=P[0]/S[0],j=P[1]/S[1],k=(c.right-c.left)/2/O,D=(c.bottom-c.top)/2/j,_=[(C[0]+M[0])/2+k,(C[1]+M[1])/2+D],F=w.unproject(_),z=Math.min(l,w.zoom+Math.log2(Math.abs(Math.min(O,j))));return d(Number.isFinite(z)),{longitude:F[0],latitude:F[1],zoom:z}}var O=Math.PI/180;function j(e){var t,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.width,r=e.height,o=e.unproject,s={targetZ:a},l=o([0,r],s),u=o([n,r],s),c=Math.atan(.5/e.altitude),g=(90-e.pitch)*O;return c>g-.01?(t=k(e,0,a),i=k(e,n,a)):(t=o([0,0],s),i=o([n,0],s)),[l,u,i,t]}function k(e,t,i){var a=e.pixelUnprojectionMatrix,n=l(a,[t,0,1,1]),r=l(a,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-n[2])/(r[2]-n[2]),s=y(c.d([],n,r,o));return s[2]=i,s}var A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},i=t.width,a=t.height,n=t.latitude,o=void 0===n?0:n,s=t.longitude,l=void 0===s?0:s,u=t.zoom,c=void 0===u?0:u,g=t.pitch,d=void 0===g?0:g,h=t.bearing,f=void 0===h?0:h,p=t.altitude,v=void 0===p?1.5:p,y=t.nearZMultiplier,C=void 0===y?.02:y,S=t.farZMultiplier,P=void 0===S?1.01:S;Object(r.a)(this,e),i=i||1,a=a||1;var O=m(c);v=Math.max(.75,v);var j=b([l,o]);j[2]=0,this.projectionMatrix=M({width:i,height:a,pitch:d,altitude:v,nearZMultiplier:C,farZMultiplier:P}),this.viewMatrix=w({height:a,scale:O,center:j,pitch:d,bearing:f,altitude:v}),this.width=i,this.height=a,this.scale=O,this.latitude=o,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=f,this.altitude=v,this.center=j,this.distanceScales=x(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(o.a)(e,[{key:\"_initMatrices\",value:function(){var e=this.width,t=this.height,i=this.projectionMatrix,a=this.viewMatrix,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.g(n,n,i),u.g(n,n,a),this.viewProjectionMatrix=n;var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.n(r,r,[e/2,-t/2,1]),u.o(r,r,[1,-1,0]),u.g(r,r,n);var o=u.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r);if(!o)throw new Error(\"Pixel project matrix not invertible\");this.pixelProjectionMatrix=r,this.pixelUnprojectionMatrix=o}},{key:\"equals\",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&u.b(t.projectionMatrix,this.projectionMatrix)&&u.b(t.viewMatrix,this.viewMatrix))}},{key:\"project\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.topLeft,a=void 0===i||i,r=this.projectPosition(e),o=C(r,this.pixelProjectionMatrix),s=Object(n.a)(o,2),l=s[0],u=s[1],c=a?u:this.height-u;return 2===e.length?[l,c]:[l,c,o[2]]}},{key:\"unproject\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.topLeft,a=void 0===i||i,r=t.targetZ,o=void 0===r?void 0:r,s=Object(n.a)(e,3),l=s[0],u=s[1],c=s[2],g=a?u:this.height-u,d=o&&o*this.distanceScales.unitsPerMeter[2],h=S([l,g,c],this.pixelUnprojectionMatrix,d),f=this.unprojectPosition(h),p=Object(n.a)(f,3),v=p[0],m=p[1],b=p[2];return Number.isFinite(c)?[v,m,b]:Number.isFinite(o)?[v,m,o]:[v,m]}},{key:\"projectPosition\",value:function(e){var t=b(e),i=Object(n.a)(t,2);return[i[0],i[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:\"unprojectPosition\",value:function(e){var t=y(e),i=Object(n.a)(t,2);return[i[0],i[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:\"projectFlat\",value:function(e){return b(e)}},{key:\"unprojectFlat\",value:function(e){return y(e)}},{key:\"getMapCenterByLngLatPosition\",value:function(e){var t=e.lngLat,i=S(e.pos,this.pixelUnprojectionMatrix),a=b(t),n=c.a([],a,c.e([],i));return y(c.a([],this.center,n))}},{key:\"getLocationAtPoint\",value:function(e){var t=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:i})}},{key:\"fitBounds\",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.width,n=this.height,r=P(Object.assign({width:a,height:n,bounds:t},i)),o=r.longitude,s=r.latitude,l=r.zoom;return new e({width:a,height:n,longitude:o,latitude:s,zoom:l})}},{key:\"getBounds\",value:function(e){var t=this.getBoundingRegion(e),i=Math.min.apply(Math,Object(a.a)(t.map((function(e){return e[0]})))),n=Math.max.apply(Math,Object(a.a)(t.map((function(e){return e[0]}))));return[[i,Math.min.apply(Math,Object(a.a)(t.map((function(e){return e[1]}))))],[n,Math.max.apply(Math,Object(a.a)(t.map((function(e){return e[1]}))))]]}},{key:\"getBoundingRegion\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return j(this,e.z||0)}}]),e}();var D=i(159);const _=[-90,90],F=[-180,180];function z(e,t,i){let[a,n]=e,[r,o]=t;return void 0===i&&(i=.25),a<n?[a,n]:[Math.max(r,a-i),Math.min(o,n+i)]}function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function L(e,t){let{points:i,width:a,height:n,minExtent:r,maxZoom:o,offset:s,padding:l=20}=t;const{bearing:u,pitch:c}=e,g=function(e){const t=z(Object(D.extent)(e,e=>e[1]),_),i=z(Object(D.extent)(e,e=>e[0]),F);return[[i[0],t[0]],[i[1],t[1]]]}(i);try{return E({},P({bounds:g,width:a,height:n,minExtent:r,maxZoom:o,offset:s,padding:l}),{bearing:u,pitch:c})}catch(e){console.error(\"Could not fit viewport\",e)}return e}},4603:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return s}));var a=i(33),n=i.n(a);const r=[1,0,1,0,0,0,0];function o(e,t){const i=parseInt(n()(t).format(\"x\"),10);return parseInt(n()(t).add(e).format(\"x\"),10)-i}function s(e,t){const i=n()(Math.min(...e)),a=n()(Math.max(...e));let s,l,u;if(t.includes(\"/\")){const e=t.split(\"/\",2);e[0].endsWith(\"Z\")?(l=n()(e[0]),s=n.a.duration(e[1])):(l=n()(e[1]),s=n.a.duration(e[0]))}else s=n.a.duration(t),l=function(e,t){const i=n()(e).subtract(t),a=e.toArray(),o=i.toArray(),s=a.map((e,t)=>o[t]!==e).indexOf(!0),l=a.map((e,t)=>{if(t===s){const i=e-o[t];return e-(e-r[t])%i}return t<s||-1===s?e:r[t]});return n()(l)}(i,s);const c=i.valueOf();for(u=l.clone();u.valueOf()<c;)u.add(s);for(;u.valueOf()>c;)u.subtract(s);let g;const d=a.valueOf();for(g=l.clone();g.valueOf()>d;)g.subtract(s);for(;g.valueOf()<d;)g.add(s);const h=null!=t?[u,u.clone().add(s)]:[u,g],f=e.every(e=>null===e);return{start:parseInt(u.format(\"x\"),10),end:parseInt(g.format(\"x\"),10),getStep:o.bind(this,s),values:h.map(e=>parseInt(e.format(\"x\"),10)),disabled:f}}},4604:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return a})),i.d(t,\"b\",(function(){return s}));var a={SUM:1,MEAN:2,MIN:3,MAX:4};function n(e,t){return e+t}function r(e,t){return t>e?t:e}function o(e,t){return t<e?t:e}function s(e,t){switch(a[e.toUpperCase()]||a.SUM){case a.MIN:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(o,1/0):null}(e,t)};case a.SUM:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(n,0):null}(e,t)};case a.MEAN:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(n,0)/i.length:null}(e,t)};case a.MAX:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(r,-1/0):null}(e,t)};default:return null}}},4606:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return b}));var a=i(0),n=i.n(a),r=i(2),o=i.n(r),s=i(4605),l=i(2171),u=i.n(l),c=i(20),g=i(4557),d=i.n(g);i(4611),i(4612);function h(e){return n.a.createElement(\"span\",{className:\"BootstrapSliderWrapper\"},n.a.createElement(d.a,e))}i(4613);const f={start:o.a.number.isRequired,step:o.a.number.isRequired,end:o.a.number.isRequired,values:o.a.array.isRequired,onChange:o.a.func,loopDuration:o.a.number,maxFrames:o.a.number,orientation:o.a.oneOf([\"horizontal\",\"vertical\"]),reversed:o.a.bool,disabled:o.a.bool,range:o.a.bool};class p extends n.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,i=Math.min(e.maxFrames,t/e.step),a=t/i;this.intervalMilliseconds=e.loopDuration/i,this.increment=a<e.step?e.step:a-a%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){u.a.bind([\"space\"],this.play)}componentWillUnmount(){u.a.unbind([\"space\"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?\"fa fa-play fa-lg slider-button\":\"fa fa-pause fa-lg slider-button\"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:i,values:a,disabled:n}=this.props;if(n)return;const r=(Array.isArray(a)?a:[a,a+i]).map(e=>e+this.increment),o=r[1]>t?r[0]-e:0;this.props.onChange(r.map(e=>e-o))}stepBackward(){const{start:e,end:t,step:i,values:a,disabled:n}=this.props;if(n)return;const r=(Array.isArray(a)?a:[a,a+i]).map(e=>e-this.increment),o=r[0]<e?t-r[1]:0;this.props.onChange(r.map(e=>e+o))}formatter(e){if(this.props.disabled)return Object(c.e)(\"Data has no time steps\");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(\" : \")}render(){const{start:e,end:t,step:i,orientation:a,reversed:r,disabled:o,range:s,values:l}=this.props;return n.a.createElement(\"div\",{className:\"play-slider\"},n.a.createElement(\"div\",{className:\"play-slider-controls padded\"},n.a.createElement(\"i\",{className:\"fa fa-step-backward fa-lg slider-button \",onClick:this.stepBackward}),n.a.createElement(\"i\",{className:this.getPlayClass(),onClick:this.play}),n.a.createElement(\"i\",{className:\"fa fa-step-forward fa-lg slider-button \",onClick:this.stepForward})),n.a.createElement(\"div\",{className:\"play-slider-scrobbler padded\"},n.a.createElement(h,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:i,orientation:a,reversed:r,disabled:o?\"disabled\":\"enabled\"})))}}function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}p.propTypes=f,p.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:\"horizontal\",reversed:!1,disabled:!1,range:!0};const m={getLayers:o.a.func.isRequired,start:o.a.number.isRequired,end:o.a.number.isRequired,getStep:o.a.func,values:o.a.array.isRequired,aggregation:o.a.bool,disabled:o.a.bool,viewport:o.a.object.isRequired,children:o.a.node,mapStyle:o.a.string,mapboxApiAccessToken:o.a.string.isRequired,setControlValue:o.a.func,onValuesChange:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired};class b extends n.a.PureComponent{constructor(){super(...arguments),v(this,\"containerRef\",n.a.createRef()),v(this,\"setTooltip\",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:i,disabled:a,aggregation:r,children:o,getLayers:l,values:u,onValuesChange:c,viewport:g,setControlValue:d,mapStyle:h,mapboxApiAccessToken:f,height:v,width:m}=this.props,b=l(u);return n.a.createElement(\"div\",null,n.a.createElement(s.a,{ref:this.containerRef,viewport:g,layers:b,setControlValue:d,mapStyle:h,mapboxApiAccessToken:f,bottomMargin:a?0:20,width:m,height:v}),!a&&n.a.createElement(p,{start:e,end:t,step:i(e),values:u,range:!r,onChange:c}),o)}}b.propTypes=m,b.defaultProps={aggregation:!1,disabled:!1,mapStyle:\"light\",setControlValue:()=>{},onValuesChange:()=>{}}},4611:function(e,t,i){},4612:function(e,t,i){},4613:function(e,t,i){},4614:function(e,t,i){\"use strict\";i.d(t,\"b\",(function(){return P})),i.d(t,\"a\",(function(){return O}));var a=i(0),n=i.n(a),r=i(2),o=i.n(r),s=i(265),l=i(4605),u=i(869),c=i(4606),g=i(4617),d=i(4621),h=i(4603),f=i(4602),p=i(4597);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{getScale:b}=u.b;const y={formData:o.a.object.isRequired,mapboxApiKey:o.a.string.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,getLayer:o.a.func.isRequired,getPoints:o.a.func.isRequired,payload:o.a.object.isRequired,onAddFilter:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired};class x extends n.a.PureComponent{constructor(e){super(e),m(this,\"containerRef\",n.a.createRef()),m(this,\"setTooltip\",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const i=e.payload.data.features||[],a=i.map(e=>e.__timestamp),n=function(e,t){const i=e.color_picker||{r:0,g:0,b:0,a:1},a=[i.r,i.g,i.b,255*i.a],n=b(e.color_scheme),r={};return t.forEach(t=>{if(null!=t.cat_color&&!r.hasOwnProperty(t.cat_color)){let o;o=e.dimension?Object(d.hexToRGB)(n(t.cat_color),255*i.a):a,r[t.cat_color]={color:o,enabled:!0}}}),r}(e.formData,i);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:n});const r=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||\"P1D\",{start:o,end:s,getStep:l,values:u,disabled:c}=Object(h.a)(a,r),{width:g,height:f,formData:m}=e;let{viewport:y}=e;return m.autozoom&&(y=Object(p.a)(y,{width:g,height:f,points:e.getPoints(i)})),{start:o,end:s,getStep:l,values:u,disabled:c,viewport:y,selected:[],lastClick:0,formData:e.payload.form_data,categories:n}}getLayers(e){const{getLayer:t,payload:i,formData:a,onAddFilter:n}=this.props;let r=i.data.features?[...i.data.features]:[];if(r=this.addColor(r,a),a.js_data_mutator){r=Object(f.a)(a.js_data_mutator)(r)}r=e[0]===e[1]||e[1]===this.end?r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const o=this.state.categories;a.dimension&&(r=r.filter(e=>o[e.cat_color]&&o[e.cat_color].enabled));return[t(a,v({},i,{data:v({},i.data,{features:r})}),n,this.setTooltip)]}addColor(e,t){const i=t.color_picker||{r:0,g:0,b:0,a:1},a=b(t.color_scheme);return e.map(e=>{let n;return t.dimension?(n=Object(d.hexToRGB)(a(e.cat_color),255*i.a),v({},e,{color:n})):e})}toggleCategory(e){const t=this.state.categories[e],i=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(i).every(e=>!e.enabled)&&Object.values(i).forEach(e=>{e.enabled=!0}),this.setState({categories:i})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return n.a.createElement(\"div\",{style:{position:\"relative\"}},n.a.createElement(c.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},n.a.createElement(g.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function M(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}x.propTypes=y;const C={formData:o.a.object.isRequired,payload:o.a.object.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,onAddFilter:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},S={onAddFilter(){}};function P(e,t){class i extends n.a.PureComponent{constructor(e){super(e),M(this,\"containerRef\",n.a.createRef()),M(this,\"setTooltip\",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:i,height:a,formData:r}=e;let{viewport:o}=e;r.autozoom&&(o=Object(p.a)(o,{width:i,height:a,points:t(e.payload.data.features)})),this.state={viewport:o,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=w({},e.formData,{viewport:null}),i=w({},this.props.formData,{viewport:null});Object(s.isEqual)(t,i)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:i,payload:a,onAddFilter:n}=t;return e(i,a,n,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:i,height:a,width:r}=this.props,{layer:o,viewport:s}=this.state;return n.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[o],mapStyle:e.mapbox_style,setControlValue:i,width:r,height:a,onViewportChange:this.onViewportChange})}}return i.propTypes=C,i.defaultProps=S,i}function O(e,t){function i(i){const{formData:a,payload:r,setControlValue:o,viewport:s,width:l,height:u}=i;return n.a.createElement(x,{formData:a,mapboxApiKey:r.data.mapboxApiKey,setControlValue:o,viewport:s,getLayer:e,payload:r,getPoints:t,width:l,height:u})}return i.propTypes=C,i.defaultProps=S,i}},4617:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return u}));var a=i(0),n=i.n(a),r=i(2),o=i.n(r),s=i(288);i(4618);const l={categories:o.a.object,toggleCategory:o.a.func,showSingleCategory:o.a.func,format:o.a.string,position:o.a.oneOf([null,\"tl\",\"tr\",\"bl\",\"br\"])};class u extends n.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.b)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(\" - \")){const t=e.split(\" - \");return this.format(t[0])+\" - \"+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,i]=e;const a={color:\"rgba(\"+i.color.join(\", \")+\")\"},r=i.enabled?\"◼\":\"◻\";return n.a.createElement(\"li\",{key:t},n.a.createElement(\"a\",{href:\"#\",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},n.a.createElement(\"span\",{style:a},r),\" \",this.formatCategoryLabel(t)))}),t={position:\"absolute\",[\"t\"===this.props.position.charAt(0)?\"top\":\"bottom\"]:\"0px\",[\"r\"===this.props.position.charAt(1)?\"right\":\"left\"]:\"10px\"};return n.a.createElement(\"div\",{className:\"legend\",style:t},n.a.createElement(\"ul\",{className:\"categories\"},e))}}u.propTypes=l,u.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:\"tr\"}},4618:function(e,t,i){},4619:function(e,t,i){\"use strict\";i.d(t,\"b\",(function(){return a})),i.d(t,\"a\",(function(){return n}));var a=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function n(e,t,i){var a=new t(4*e.length);return e.forEach((function(e,t){var n=4*t;a[n]=e[0],a[n+1]=e[1],a[n+2]=e[2],a[n+3]=Number.isFinite(e[3])?e[3]:i})),a}},4635:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return B}));var a,n=i(5),r=i(7),o=i(16),s=i(17),l=i(5066),u=i(5022),c=i(5023),g=i(4895),d=i(4637),h=i(4996),f=i(4836),p=i(5060),v=i(5025),m=i(4599),b=i(4716),y=i(4604),x={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},w={changeFlags:x,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},M=3402823466e29,C=[32775,32774],S=[32776,32774],P=[32776,32775],O=(a={},Object(n.a)(a,y.a.SUM,32774),Object(n.a)(a,y.a.MEAN,32774),Object(n.a)(a,y.a.MIN,C),Object(n.a)(a,y.a.MAX,S),a),j={size:1,operation:y.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},k=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],A=\"#define SHADER_NAME gpu-aggregation-to-grid-vs\\n\\nattribute vec2 positions;\\nattribute vec3 weights;\\nuniform vec2 windowSize;\\nuniform vec2 cellSize;\\nuniform vec2 gridSize;\\nuniform mat4 uProjectionMatrix;\\nuniform bool projectPoints;\\n\\nvarying vec3 vWeights;\\n\\nvec2 project_to_pixel(vec4 pos) {\\n  vec4 result =  uProjectionMatrix * pos;\\n  return result.xy/result.w;\\n}\\n\\nvoid main(void) {\\n\\n  vWeights = weights;\\n\\n  vec4 windowPos = vec4(positions, 0, 1.);\\n  if (projectPoints) {\\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\\n  }\\n\\n  vec2 pos = project_to_pixel(windowPos);\\n  pos = floor(pos / cellSize);\\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\\n  vec2 offset = 1.0 / gridSize;\\n  pos = pos + offset;\\n\\n  gl_Position = vec4(pos, 0.0, 1.0);\\n}\\n\",D=\"#define SHADER_NAME gpu-aggregation-to-grid-vs-64\\n\\nattribute vec2 positions;\\nattribute vec2 positions64xyLow;\\nattribute vec3 weights;\\nuniform vec2 windowSize;\\nuniform vec2 cellSize;\\nuniform vec2 gridSize;\\nuniform vec2 uProjectionMatrixFP64[16];\\nuniform bool projectPoints;\\n\\nvarying vec3 vWeights;\\n\\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\\n\\n  vec2 result64[4];\\n  vec2 position64[4];\\n  position64[0] = vec2(pos.x, pos64xyLow.x);\\n  position64[1] = vec2(pos.y, pos64xyLow.y);\\n  position64[2] = vec2(0., 0.);\\n  position64[3] = vec2(1., 0.);\\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\\n  result64);\\n\\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\\n}\\n\\nvoid main(void) {\\n\\n  vWeights = weights;\\n\\n  vec2 windowPos = positions;\\n  vec2 windowPos64xyLow = positions64xyLow;\\n  if (projectPoints) {\\n    vec2 projectedXY[2];\\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\\n    windowPos.x = projectedXY[0].x;\\n    windowPos.y = projectedXY[1].x;\\n    windowPos64xyLow.x = projectedXY[0].y;\\n    windowPos64xyLow.y = projectedXY[1].y;\\n  }\\n\\n  vec2 pixelXY64[2];\\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\\n  vec2 gridXY64[2];\\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\\n  float x = floor(gridXY64[0].x);\\n  float y = floor(gridXY64[1].x);\\n  vec2 pos = vec2(x, y);\\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\\n  vec2 offset = 1.0 / gridSize;\\n  pos = pos + offset;\\n\\n  gl_Position = vec4(pos, 0.0, 1.0);\\n}\\n\",_=\"#define SHADER_NAME gpu-aggregation-to-grid-fs\\n\\nprecision highp float;\\n\\nvarying vec3 vWeights;\\n\\nvoid main(void) {\\n  gl_FragColor = vec4(vWeights, 1.0);\\n}\\n\",F=i(4760),z=i(4669);function E(e,t){var i,a=t.width,r=void 0===a?1:a,o=t.height,s=void 0===o?1:o;return new F.a(e,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(i={},Object(n.a)(i,10240,9728),Object(n.a)(i,10241,9728),i),dataFormat:6408,width:r,height:s})}function L(e,t){var i=t.id,a=t.width,r=void 0===a?1:a,o=t.height,s=void 0===o?1:o,l=t.texture;return new z.a(e,{id:i,width:r,height:s,attachments:Object(n.a)({},36064,l)})}function R(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!e||e.length<t?new Float32Array(t).fill(i):e}var T=l.a.fp64ifyMatrix4,N=[\"aggregationBuffer\",\"maxMinBuffer\",\"minBuffer\",\"maxBuffer\"],I={maxData:\"maxBuffer\",minData:\"minBuffer\",maxMinData:\"maxMinBuffer\"},B=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,e),this.id=i.id||\"gpu-grid-aggregator\",this.shaderCache=i.shaderCache||null,this.gl=t,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(u.d)(t)&&Object(c.c)(this.gl,g.a.BLEND_EQUATION_MINMAX,g.a.COLOR_ATTACHMENT_RGBA32F,g.a.TEXTURE_FLOAT)}return Object(s.a)(e,null,[{key:\"getAggregationData\",value:function(e){var t=e.aggregationData,i=e.maxData,a=e.minData,n=e.maxMinData,r=4*e.pixelIndex,o={};return t&&(o.cellCount=t[r+3],o.cellWeight=t[r]),n?(o.maxCellWieght=n[0],o.minCellWeight=n[3]):(i&&(o.maxCellWieght=i[0],o.totalCount=i[3]),a&&(o.minCellWeight=a[0],o.totalCount=i[3])),o}},{key:\"getCellData\",value:function(e){for(var t=e.countsData,i=e.size,a=void 0===i?1:i,n=t.length/4,r=new Float32Array(n*a),o=new Uint32Array(n),s=0;s<n;s++){for(var l=0;l<a;l++)r[s*a+l]=t[4*s+l];o[s]=t[4*s+3]}return{cellCounts:o,cellWeights:r}}},{key:\"isSupported\",value:function(e){return Object(u.d)(e)&&Object(c.c)(e,g.a.BLEND_EQUATION_MINMAX,g.a.COLOR_ATTACHMENT_RGBA32F,g.a.TEXTURE_FLOAT)}}]),Object(s.a)(e,[{key:\"delete\",value:function(){var e=this.gridAggregationModel,t=this.allAggregationModel,i=this.meanTransform,a=this.state,n=a.positionsBuffer,r=a.positions64xyLowBuffer,o=a.textures,s=a.framebuffers,l=a.maxMinFramebuffers,u=a.minFramebuffers,c=a.maxFramebuffers,g=a.meanTextures,d=a.resources;e&&e.delete(),t&&t.delete(),i&&i.delete(),n&&n.delete(),r&&r.delete(),this.deleteResources([s,o,l,u,c,g,d])}},{key:\"run\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var t=this.getAggregationParams(e);this.updateGridSize(t);var i=t.useGPU;return this._hasGPUSupport&&i?this.runAggregationOnGPU(t):(i&&m.a.info(\"GPUGridAggregator: GPU Aggregation not supported, falling back to CPU\")(),this.runAggregationOnCPU(t))}},{key:\"getData\",value:function(e){var t={},i=this.state.results;for(var a in i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),t.aggregationData=i[e].aggregationData,I){var n=I[a];(i[e][a]||i[e][n])&&(i[e][a]=i[e][a]||i[e][n].getData(),t[a]=i[e][a])}return t}},{key:\"deleteResources\",value:function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){for(var t in e)e[t].delete()}))}},{key:\"getAggregationParams\",value:function(e){var t=Object.assign({},w,e),i=t.useGPU,a=t.gridTransformMatrix,n=t.viewport,r=t.weights,o=t.projectPoints,s=t.cellSize;return this.state.useGPU!==i&&(t.changeFlags=Object.assign({},t.changeFlags,x)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(t.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(t,e),this.setState({useGPU:i}),t.gridTransformMatrix=(o?n.viewportMatrix:a)||k,r&&(t.weights=this.normalizeWeightParams(r),this.setState({weights:t.weights})),t}},{key:\"normalizeWeightParams\",value:function(e){var t={};for(var i in e)t[i]=Object.assign({},j,e[i]);return t}},{key:\"setState\",value:function(e){Object.assign(this.state,e)}},{key:\"shouldTransformToGrid\",value:function(e){var t=e.projectPoints,i=e.changeFlags;return!!(!this.state.gridPositions||i.dataChanged||t&&i.viewportChanged)}},{key:\"updateGridSize\",value:function(e){var t=e.viewport,i=e.cellSize,a=e.width||t.width,n=e.height||t.height,r=Math.ceil(a/i[0]),o=Math.ceil(n/i[1]);this.setState({numCol:r,numRow:o,windowSize:[a,n]})}},{key:\"validateProps\",value:function(e,t){var i=e.changeFlags,a=e.projectPoints,n=e.gridTransformMatrix;m.a.assert(i.dataChanged||i.viewportChanged||i.cellSizeChanged),m.a.assert(!i.dataChanged||t.positions&&t.weights&&(!t.projectPositions||t.viewport)&&t.cellSize),m.a.assert(!i.cellSizeChanged||t.cellSize),m.a.assert(!(i.viewportChanged&&a)||t.viewport),a&&n&&m.a.warn(\"projectPoints is true, gridTransformMatrix is ignored\")()}},{key:\"calculateAggregationData\",value:function(e){var t=e.weights,i=e.results,a=e.cellIndex,n=e.posIndex;for(var r in t){for(var o=t[r],s=o.values,l=o.size,u=o.operation,c=i[r].aggregationData,g=0;g<l;g++){var d=a+g,h=s[3*n+g];if(0===c[a+3])c[d]=h;else switch(u){case y.a.SUM:case y.a.MEAN:c[d]+=h;break;case y.a.MIN:c[d]=Math.min(c[d],h);break;case y.a.MAX:c[d]=Math.max(c[d],h);break;default:m.a.assert(!1)}}c[a+3]++}}},{key:\"calculateMeanMaxMinData\",value:function(e){var t=e.validCellIndices,i=e.results,a=e.weights;t.forEach((function(e){for(var t in i){for(var n=a[t],r=n.size,o=n.needMin,s=n.needMax,l=n.operation,u=i[t],c=u.aggregationData,g=u.minData,d=u.maxData,h=u.maxMinData,f=o||s,p=l===y.a.MEAN,v=o&&s&&a[t].combineMaxMin,m=c[e+4-1],b=0;b<r&&(f||p);b++){var x=e+b,w=c[x];p&&(c[x]/=m,w=c[x]),v?h[b]=Math.max(h[b],w):(o&&(g[b]=Math.min(g[b],w)),s&&(d[b]=Math.max(d[b],w)))}v?h[3]=Math.min(h[3],c[e+0]):(o&&(g[3]+=m),s&&(d[3]+=m))}}))}},{key:\"initCPUResults\",value:function(e){var t=e.weights||this.state.weights,i=this.state,a=i.numCol,n=i.numRow,r={};for(var o in t){var s=t[o],l=s.aggregationData,u=s.minData,c=s.maxData,g=s.maxMinData,d=t[o],h=d.needMin,f=d.needMax,p=h&&f&&t[o].combineMaxMin;l=R(l,a*n*4),p?((g=R(g,4)).fill(-1/0,0,3),g[3]=1/0):(h&&((u=R(u,4,1/0))[3]=0),f&&((c=R(c,4,-1/0))[3]=0)),r[o]=Object.assign({},t[o],{aggregationData:l,minData:u,maxData:c,maxMinData:g})}return r}},{key:\"runAggregationOnCPU\",value:function(e){var t,i,a=e.positions,n=e.cellSize,o=e.gridTransformMatrix,s=e.viewport,l=e.projectPoints,u=e.weights,c=this.state,g=c.numCol,d=c.numRow,h=this.initCPUResults(e),f=this.shouldTransformToGrid(e),p=[0,0,0];m.a.assert(f||e.changeFlags.cellSizeChanged),f?(i=a.length/2,t=new Float64Array(a.length),this.setState({gridPositions:t})):(t=this.state.gridPositions,u=this.state.weights,i=t.length/2);for(var v=new Set,y=0;y<i;y++){var x=void 0,w=void 0;if(f){if(p[0]=a[2*y],p[1]=a[2*y+1],l){var M=s.project(p),C=Object(r.a)(M,2);x=C[0],w=C[1]}else{var S=Object(b.k)(p,o),P=Object(r.a)(S,2);x=P[0],w=P[1]}t[2*y]=x,t[2*y+1]=w}else x=t[2*y],w=t[2*y+1];var O=Math.floor(x/n[0]),j=Math.floor(w/n[1]);if(O>=0&&O<g&&j>=0&&j<d){var k=4*(O+j*g);v.add(k),this.calculateAggregationData({weights:u,results:h,cellIndex:k,posIndex:y})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:h,weights:u}),this.updateAggregationBuffers(e,h),this.setState({results:h}),h}},{key:\"updateCPUResultBuffer\",value:function(e){var t=e.gl,i=e.bufferName,a=e.id,n=e.data,r=e.result,o=this.state.resources,s=\"cpu-result-\".concat(a,\"-\").concat(i);r[i]=r[i]||o[s],r[i]?r[i].setData({data:n}):(o[s]=new d.a(t,n),r[i]=o[s])}},{key:\"updateAggregationBuffers\",value:function(e,t){if(e.createBufferObjects){var i=e.weights||this.state.weights;for(var a in t){var n=t[a],r=n.aggregationData,o=n.minData,s=n.maxData,l=n.maxMinData,u=i[a],c=u.needMin,g=u.needMax,d=c&&g&&i[a].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:\"aggregationBuffer\",id:a,data:r,result:t[a]}),d?this.updateCPUResultBuffer({gl:this.gl,bufferName:\"maxMinBuffer\",id:a,data:l,result:t[a]}):(c&&this.updateCPUResultBuffer({gl:this.gl,bufferName:\"minBuffer\",id:a,data:o,result:t[a]}),g&&this.updateCPUResultBuffer({gl:this.gl,bufferName:\"maxBuffer\",id:a,data:s,result:t[a]}))}}}},{key:\"getAggregateData\",value:function(e){var t={},i=this.state,a=i.textures,n=i.framebuffers,r=i.maxMinFramebuffers,o=i.minFramebuffers,s=i.maxFramebuffers,l=i.weights;for(var u in l){t[u]={};var c=l[u],g=c.needMin,d=c.needMax,f=c.combineMaxMin;t[u].aggregationTexture=a[u],t[u].aggregationBuffer=Object(h.c)(n[u],{target:l[u].aggregationBuffer,sourceType:5126}),g&&d&&f?t[u].maxMinBuffer=Object(h.c)(r[u],{target:l[u].maxMinBuffer,sourceType:5126}):(g&&(t[u].minBuffer=Object(h.c)(o[u],{target:l[u].minBuffer,sourceType:5126})),d&&(t[u].maxBuffer=Object(h.c)(s[u],{target:l[u].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(t,l),t}},{key:\"getAggregationModel\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.gl,i=this.shaderCache;return new f.a(t,{id:\"Gird-Aggregation-Model\",vs:e?D:A,fs:_,modules:e?[\"fp64\",\"project64\"]:[\"project32\"],shaderCache:i,vertexCount:0,drawMode:0})}},{key:\"getAllAggregationModel\",value:function(){var e=this.gl,t=this.shaderCache,i=this.state,a=i.numCol,n=i.numRow;return new f.a(e,{id:\"All-Aggregation-Model\",vs:\"#version 300 es\\n#define SHADER_NAME gpu-aggregation-all-vs-64\\n\\nin vec2 position;\\nuniform ivec2 gridSize;\\nout vec2 vTextureCoord;\\n\\nvoid main(void) {\\n  vec2 pos = vec2(-1.0, -1.0);\\n  vec2 offset = 1.0 / vec2(gridSize);\\n  pos = pos + offset;\\n\\n  gl_Position = vec4(pos, 0.0, 1.0);\\n\\n  int yIndex = gl_InstanceID / gridSize[0];\\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\\n\\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\\n\\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\\n\\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\\n}\\n\",fs:\"#version 300 es\\n#define SHADER_NAME gpu-aggregation-all-fs\\n\\nprecision highp float;\\n\\nin vec2 vTextureCoord;\\nuniform sampler2D uSampler;\\nuniform bool combineMaxMin;\\nout vec4 fragColor;\\nvoid main(void) {\\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n  if (textureColor.a == 0.) {\\n    discard;\\n  }\\n  fragColor.rgb = textureColor.rgb;\\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\\n}\\n\",modules:[\"fp64\"],shaderCache:t,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:a*n,attributes:{position:[0,0]}})}},{key:\"getMeanTransform\",value:function(e){return this.meanTransform?this.meanTransform.update(e):this.meanTransform=new p.a(this.gl,Object.assign({},{vs:\"#define SHADER_NAME gpu-aggregation-transform-mean-vs\\nattribute vec4 aggregationValues;\\nvarying vec4 meanValues;\\n\\nvoid main()\\n{\\n  bool isCellValid = bool(aggregationValues.w > 0.);\\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\\n  meanValues.w = aggregationValues.w;\\n}\\n\",_targetTextureVarying:\"meanValues\"},e)),this.meanTransform}},{key:\"renderAggregateData\",value:function(e){var t=e.cellSize,i=e.viewport,a=e.gridTransformMatrix,n=e.projectPoints,r=this.state,o=r.numCol,s=r.numRow,l=r.windowSize,u=r.maxMinFramebuffers,c=r.minFramebuffers,g=r.maxFramebuffers,d=r.weights,h=[o,s],f={blend:!0,depthTest:!1,blendFunc:[1,1]},p={viewport:i},v={windowSize:l,cellSize:t,gridSize:h,uProjectionMatrix:a,uProjectionMatrixFP64:T(a),projectPoints:n};for(var m in d){var b=d[m],y=b.needMin,x=b.needMax,w=y&&x&&d[m].combineMaxMin;this.renderToWeightsTexture({id:m,parameters:f,moduleSettings:p,uniforms:v,gridSize:h}),w?this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:P}),gridSize:h,minOrMaxFb:u[m],clearParams:{clearColor:[0,0,0,M]},combineMaxMin:w}):(y&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:C}),gridSize:h,minOrMaxFb:c[m],clearParams:{clearColor:[M,M,M,0]},combineMaxMin:w}),x&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:S}),gridSize:h,minOrMaxFb:g[m],combineMaxMin:w}))}}},{key:\"renderToMaxMinTexture\",value:function(e){var t=e.id,i=e.parameters,a=e.gridSize,n=e.minOrMaxFb,r=e.combineMaxMin,o=e.clearParams,s=void 0===o?{}:o,l=this.state.framebuffers,u=this.gl,c=this.allAggregationModel;n.bind(),u.viewport(0,0,a[0],a[1]),Object(v.a)(u,s,(function(){u.clear(16384)})),c.draw({parameters:i,uniforms:{uSampler:l[t].texture,gridSize:a,combineMaxMin:r}}),n.unbind()}},{key:\"renderToWeightsTexture\",value:function(e){var t=e.id,i=e.parameters,a=e.moduleSettings,r=e.uniforms,o=e.gridSize,s=this.state,l=s.framebuffers,u=s.equations,c=s.weightAttributes,g=s.weights,d=this.gl,h=this.gridAggregationModel,f=g[t].operation;l[t].bind(),d.viewport(0,0,o[0],o[1]);var p=f===y.a.MIN?[M,M,M,0]:[0,0,0,0];Object(v.a)(d,{clearColor:p},(function(){d.clear(16384)}));var m={weights:c[t]};if(h.draw({parameters:Object.assign({},i,{blendEquation:u[t]}),moduleSettings:a,uniforms:r,attributes:m}),l[t].unbind(),f===y.a.MEAN){var b=this.state,x=b.meanTextures,w=b.textures,C={_sourceTextures:{aggregationValues:x[t]},_targetTexture:w[t],elementCount:w[t].width*w[t].height};this.getMeanTransform(C).run({parameters:{blend:!1,depthTest:!1}}),l[t].attach(Object(n.a)({},36064,w[t]))}}},{key:\"runAggregationOnGPU\",value:function(e){this.updateModels(e),this.setupFramebuffers(e),this.renderAggregateData(e);var t=this.getAggregateData(e);return this.setState({results:t}),t}},{key:\"setupFramebuffers\",value:function(e){var t=this.state,i=t.numCol,a=t.numRow,r=t.textures,o=t.framebuffers,s=t.maxMinFramebuffers,l=t.minFramebuffers,u=t.maxFramebuffers,c=t.resources,g=t.meanTextures,d=t.equations,h=t.weights,f={width:i,height:a};for(var p in h){var v=h[p],m=v.needMin,b=v.needMax,x=v.combineMaxMin,w=v.operation;r[p]=h[p].aggregationTexture||r[p]||E(this.gl,{id:\"\".concat(p,\"-texture\"),width:i,height:a}),r[p].resize(f);var M=r[p];w===y.a.MEAN&&(g[p]=g[p]||E(this.gl,{id:\"\".concat(p,\"-mean-texture\"),width:i,height:a}),g[p].resize(f),M=g[p]),o[p]?o[p].attach(Object(n.a)({},36064,M)):o[p]=L(this.gl,{id:\"\".concat(p,\"-fb\"),width:i,height:a,texture:M}),o[p].resize(f),d[p]=O[w],(m||b)&&(m&&b&&x?s[p]||(c[\"\".concat(p,\"-maxMin\")]=E(this.gl,{id:\"\".concat(p,\"-maxMinTex\")}),s[p]=L(this.gl,{id:\"\".concat(p,\"-maxMinFb\"),texture:c[\"\".concat(p,\"-maxMin\")]})):(m&&(l[p]||(c[\"\".concat(p,\"-min\")]=E(this.gl,{id:\"\".concat(p,\"-minTex\")}),l[p]=L(this.gl,{id:\"\".concat(p,\"-minFb\"),texture:c[\"\".concat(p,\"-min\")]}))),b&&(u[p]||(c[\"\".concat(p,\"-max\")]=E(this.gl,{id:\"\".concat(p,\"-maxTex\")}),u[p]=L(this.gl,{id:\"\".concat(p,\"-maxFb\"),texture:c[\"\".concat(p,\"-max\")]})))))}}},{key:\"setupModels\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(e),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:\"setupWeightAttributes\",value:function(e){var t=this.state,i=t.weightAttributes,a=t.vertexCount,n=t.weights,r=t.resources;for(var o in n){var s=n[o].values;if(Array.isArray(s)||s.constructor===Float32Array){m.a.assert(s.length/3===a);var l=Array.isArray(s)?new Float32Array(s):s;i[o]instanceof d.a?i[o].setData(l):(r[\"\".concat(o,\"-buffer\")]=new d.a(this.gl,l),i[o]=r[\"\".concat(o,\"-buffer\")])}else m.a.assert(s instanceof d.a),i[o]=s}}},{key:\"trackGPUResultBuffers\",value:function(e,t){var i=this.state.resources;for(var a in e)if(e[a])for(var n=0;n<N.length;n++){var r=N[n];if(e[a][r]&&t[a][r]!==e[a][r]){var o=\"gpu-result-\".concat(a,\"-\").concat(r);i[o]&&i[o].delete(),i[o]=e[a][r]}}}},{key:\"updateModels\",value:function(e){var t=this.gl,i=e.positions,a=e.positions64xyLow,n=e.changeFlags,r=this.state,o=r.numCol,s=r.numRow,l={},u=!1;if(e.fp64!==this.state.fp64&&(this.setupModels(e.fp64),this.setState({fp64:e.fp64}),u=!0),n.dataChanged||!this.state.positionsBuffer){var c=this.state,g=c.positionsBuffer,h=c.positions64xyLowBuffer;g&&g.delete(),h&&h.delete();var f=i.length/2;g=new d.a(t,new Float32Array(i)),h=new d.a(t,{data:new Float32Array(a),accessor:{size:2}}),this.setState({positionsBuffer:g,positions64xyLowBuffer:h,vertexCount:f}),this.setupWeightAttributes(e),u=!0}if(u){var p=this.state,v=p.vertexCount,m=p.positionsBuffer,b=p.positions64xyLowBuffer;l.positions=m,e.fp64&&(l.positions64xyLow=b),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(n.cellSizeChanged||n.viewportChanged)&&this.allAggregationModel.setInstanceCount(o*s)}}]),e}()},4650:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return d}));var a=i(16),n=i(17),r=i(178),o=i(80),s=i(229),l=i(19),u=i(4636),c=i(4599),g=i(4627),d=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(n.a)(t,[{key:\"getSubLayers\",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:\"initializeState\",value:function(){}},{key:\"setState\",value:function(e){Object(s.a)(Object(o.a)(t.prototype),\"setState\",this).call(this,e),this.setLayerNeedsUpdate()}},{key:\"getPickingInfo\",value:function(e){return e.info}},{key:\"renderLayers\",value:function(){return null}},{key:\"shouldRenderSubLayer\",value:function(e,t){var i=this.props._subLayerProps;return t&&t.length||i&&i[e]}},{key:\"getSubLayerClass\",value:function(e,t){var i=this.props._subLayerProps;return i&&i[e]&&i[e].type||t}},{key:\"getSubLayerProps\",value:function(e){var t=this.props,i=t.opacity,a=t.pickable,n=t.visible,r=t.parameters,o=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,u=t.highlightColor,c=t.coordinateSystem,g=t.coordinateOrigin,d=t.wrapLongitude,h=t.positionFormat,f=t.modelMatrix,p=t._subLayerProps,v={opacity:i,pickable:a,visible:n,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:g,wrapLongitude:d,positionFormat:h,modelMatrix:f};if(e){var m=p&&p[e.id],b=m&&m.updateTriggers;Object.assign(v,e,m,{id:\"\".concat(this.props.id,\"-\").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,b)})}return v}},{key:\"_getAttributeManager\",value:function(){return null}},{key:\"_renderLayers\",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?c.a.log(3,\"Composite layer reused subLayers \".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(g.b)(e,{filter:Boolean}),this.internalState.subLayers=e,c.a.log(2,\"Composite layer rendered new subLayers \".concat(this),e)());var t=!0,i=!1,a=void 0;try{for(var n,r=e[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.parent=this}}catch(e){i=!0,a=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw a}}}},{key:\"isComposite\",get:function(){return!0}}]),t}(u.a);d.layerName=\"CompositeLayer\"},4651:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return l}));var a=i(5),n=i(7),r=i(16),o=i(17),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(r.a)(this,e),this.sortedBins=this.getSortedBins(t,i),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(o.a)(e,[{key:\"getSortedBins\",value:function(e,t){return e.reduce((function(e,i,a){var n=t(i.points);return null!=n&&e.push({i:Number.isFinite(i.index)?i.index:a,value:n,counts:i.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:\"getValueRange\",value:function(e){var t=Object(n.a)(e,2),i=t[0],a=t[1],r=this.sortedBins.length;if(!r)return[0,0];var o=Math.ceil(i/100*(r-1)),s=Math.floor(a/100*(r-1));return[this.sortedBins[o].value,this.sortedBins[s].value]}},{key:\"getMaxCount\",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:\"getBinMap\",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(a.a)({},t.i,t))}),{})}}]),e}()},4652:function(e,t,i){\"use strict\";i.d(t,\"b\",(function(){return n})),i.d(t,\"a\",(function(){return r}));var a=i(4599);function n(e,t){return function(i){return function(e,t,i){var n=e[1]-e[0];if(n<=0)return a.a.warn(\"quantizeScale: invalid domain, returning range[0]\")(),t[0];var r=n/t.length,o=Math.floor((i-e[0])/r);return t[Math.max(Math.min(o,t.length-1),0)]}(e,t,i)}}function r(e,t){return function(i){return(i-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},4703:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return C}));var a=i(16),n=i(17),r=i(178),o=i(80),s=i(229),l=i(19),u=i(4684),c=i(4636),g=i(5066),d=i(4708),h=i(4836),f=i(1504),p=i(4599),v=i(5024),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)(this,t);var i=e.id,n=void 0===i?Object(v.c)(\"column-geometry\"):i,s=b(e),l=s.indices,u=s.attributes;return Object(r.a)(this,Object(o.a)(t).call(this,Object(f.a)({},e,{id:n,indices:l,attributes:u})))}return Object(l.a)(t,e),t}(i(4733).a);function b(e){var t=e.radius,i=e.height,a=void 0===i?1:i,n=e.nradial,r=void 0===n?10:n,o=e.vertices;p.a.assert(!o||o.length>=r);for(var s=r+1,l=3*s,u=2*Math.PI/r,c=new Uint16Array(3*r*2),g=new Float32Array(3*l),d=new Float32Array(3*l),h=0,f=0;f<s;f++)for(var v=f*u,m=o&&o[f%r],b=o&&o[(f+1)%r],y=Math.sin(v),x=Math.cos(v),w=0;w<2;w++)g[h+0]=m?m[0]:x*t,g[h+1]=m?m[1]:y*t,g[h+2]=(.5-w)*a,d[h+0]=m?b[0]-m[0]:x,d[h+1]=m?b[1]-m[1]:y,h+=3;for(var M=0;M<s;M++){var C=Math.floor(M/2)*Math.sign(M%2-.5),S=C*u,P=o&&o[(C+r)%r],O=Math.sin(S),j=Math.cos(S);g[h+0]=P?P[0]:j*t,g[h+1]=P?P[1]:O*t,g[h+2]=a/2,d[h+2]=1,h+=3}for(var k=0,A=0;A<r;A++)c[k++]=2*A+0,c[k++]=2*A+2,c[k++]=2*A+0,c[k++]=2*A+1,c[k++]=2*A+1,c[k++]=2*A+3;return{indices:c,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:d}}}}var y=g.a.fp64LowPart,x=new d.a,w=[0,0,0,255],M={diskResolution:{type:\"number\",min:4,value:20},vertices:null,radius:{type:\"number\",min:0,value:1e3},angle:{type:\"number\",value:0},offset:{type:\"array\",value:[0,0]},coverage:{type:\"number\",min:0,max:1,value:1},elevationScale:{type:\"number\",min:0,value:1},lineWidthUnits:\"meters\",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:\"accessor\",value:function(e){return e.position}},getFillColor:{type:\"accessor\",value:w},getLineColor:{type:\"accessor\",value:w},getLineWidth:{type:\"accessor\",value:1},getElevation:{type:\"accessor\",value:1e3},material:x,getColor:{deprecatedFor:[\"getFillColor\",\"getLineColor\"]}},C=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(n.a)(t,[{key:\"getShaders\",value:function(){return{vs:\"\\n#define SHADER_NAME column-layer-vertex-shader\\n\\nattribute vec3 positions;\\nattribute vec3 normals;\\n\\nattribute vec3 instancePositions;\\nattribute float instanceElevations;\\nattribute vec2 instancePositions64xyLow;\\nattribute vec4 instanceFillColors;\\nattribute vec4 instanceLineColors;\\nattribute float instanceStrokeWidths;\\n\\nattribute vec3 instancePickingColors;\\nuniform float opacity;\\nuniform float radius;\\nuniform float angle;\\nuniform vec2 offset;\\nuniform bool extruded;\\nuniform bool isStroke;\\nuniform float coverage;\\nuniform float elevationScale;\\nuniform float edgeDistance;\\nuniform float widthScale;\\nuniform float widthMinPixels;\\nuniform float widthMaxPixels;\\nvarying vec4 vColor;\\n\\nvoid main(void) {\\n  \\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\\n  float elevation = 0.0;\\n  float strokeOffsetRatio = 1.0;\\n\\n  if (extruded) {\\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\\n  } else if (isStroke) {\\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\\n      widthMinPixels, widthMaxPixels) / 2.0;\\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\\n  }\\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\\n  float dotRadius = radius * coverage * shouldRender;\\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\\n\\n  vec4 position_commonspace;\\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\\n\\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\\n\\n  if (extruded && !isStroke) {\\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\\n  } else {\\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\\n  }\\n  picking_setPickingColor(instancePickingColors);\\n}\\n\",fs:\"#define SHADER_NAME column-layer-fragment-shader\\n\\nprecision highp float;\\n\\nvarying vec4 vColor;\\n\\nvoid main(void) {\\n  gl_FragColor = vColor;\\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\\n}\\n\",modules:[this.use64bitProjection()?\"project64\":\"project32\",\"gouraud-lighting\",\"picking\"]}}},{key:\"initializeState\",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:\"getPosition\"},instanceElevations:{size:1,transition:!0,accessor:\"getElevation\"},instancePositions64xyLow:{size:2,accessor:\"getPosition\",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:\"getFillColor\",defaultValue:w},instanceLineColors:{size:4,type:5121,transition:!0,accessor:\"getLineColor\",defaultValue:w},instanceStrokeWidths:{size:1,accessor:\"getLineWidth\",transition:!0}})}},{key:\"updateState\",value:function(e){var i=e.props,a=e.oldProps,n=e.changeFlags;Object(s.a)(Object(o.a)(t.prototype),\"updateState\",this).call(this,{props:i,oldProps:a,changeFlags:n});var r=i.fp64!==a.fp64;if(r){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(r||i.diskResolution!==a.diskResolution||i.vertices!==a.vertices)&&this._updateGeometry(i)}},{key:\"getGeometry\",value:function(e,t){var i=new m({radius:1,height:2,vertices:t,nradial:e}),a=0;if(t)for(var n=0;n<e;n++){var r=t[n];a+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else a=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*a}),i}},{key:\"_getModel\",value:function(e){return new h.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:\"_updateGeometry\",value:function(e){var t=e.diskResolution,i=e.vertices,a=this.getGeometry(t,i);this.setState({fillVertexCount:a.attributes.POSITION.value.length/3,wireframeVertexCount:a.indices.value.length}),this.state.model.setProps({geometry:a})}},{key:\"draw\",value:function(e){var t=e.uniforms,i=this.context.viewport,a=this.props,n=a.lineWidthUnits,r=a.lineWidthScale,o=a.lineWidthMinPixels,s=a.lineWidthMaxPixels,l=a.elevationScale,u=a.extruded,c=a.filled,g=a.stroked,d=a.wireframe,h=a.offset,f=a.coverage,p=a.radius,v=a.angle,m=this.state,b=m.model,y=m.fillVertexCount,x=m.wireframeVertexCount,w=m.edgeDistance,M=\"pixels\"===n?i.distanceScales.metersPerPixel[2]:1;b.setUniforms(Object.assign({},t,{radius:p,angle:v/180*Math.PI,offset:h,extruded:u,coverage:f,elevationScale:l,edgeDistance:w,widthScale:r*M,widthMinPixels:o,widthMaxPixels:s})),u&&d&&(b.setProps({isIndexed:!0}),b.setVertexCount(x).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(b.setProps({isIndexed:!1}),b.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&g&&(b.setProps({isIndexed:!1}),b.setVertexCount(2*y/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:\"calculateInstancePositions64xyLow\",value:function(e,t){var i=t.startRow,a=t.endRow,n=this.use64bitPositions();if(e.constant=!n,n){var r=this.props,o=r.data,s=r.getPosition,l=e.value,c=i*e.size,g=Object(u.a)(o,i,a),d=g.iterable,h=g.objectInfo,f=!0,p=!1,v=void 0;try{for(var m,b=d[Symbol.iterator]();!(f=(m=b.next()).done);f=!0){var x=m.value;h.index++;var w=s(x,h);l[c++]=y(w[0]),l[c++]=y(w[1])}}catch(e){p=!0,v=e}finally{try{f||null==b.return||b.return()}finally{if(p)throw v}}}else e.value=new Float32Array(2)}}]),t}(c.a);C.layerName=\"ColumnLayer\",C.defaultProps=M},4708:function(e,t,i){\"use strict\";i.d(t,\"a\",(function(){return u}));var a=i(16),n=i(178),r=i(80),o=i(29),s=i(19),l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},u=function(e){function t(e){var i;return Object(a.a)(this,t),i=Object(n.a)(this,Object(r.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(o.a)(i),e),i}return Object(s.a)(t,e),t}((function e(){Object(a.a)(this,e)}))},4838:function(e,t,i){\"use strict\";i.r(t),i.d(t,\"getLayer\",(function(){return de}));var a=i(16),n=i(17),r=i(178),o=i(80),s=i(19),l=i(4650),u=i(4635),c=i(229),g=i(4708),d=i(4599),h=i(4604),f=i(4731),p=i(5066),v=i(4592),m=i(4647),b=i(4684),y=v.a.count,x=p.a.fp64LowPart;function w(e){return Number.isFinite(e)?e:0}function M(e){var t=e.data,i=e.getPosition,a=e.cellSizeMeters,n=e.gpuGridAggregator,r=e.gpuAggregation,o=e.aggregationFlags,s=e.weightParams,l=e.fp64,u=void 0!==l&&l,c=e.coordinateSystem,g=void 0===c?m.a.LNGLAT:c,h=e.viewport,p=void 0===h?null:h,v=e.boundingBox,M=void 0===v?null:v,S={};o.dataChanged&&(M=(S=function(e,t,i){var a,n,r=y(e),o=new Float64Array(2*r),s=new Float32Array(2*r),l=1/0,u=-1/0,c=1/0,g=-1/0,d={};for(var h in i)d[h]=Object.assign({},i[h],{values:new Float32Array(3*r)});var f=Object(b.a)(e),p=f.iterable,v=f.objectInfo,m=!0,M=!1,C=void 0;try{for(var S,P=p[Symbol.iterator]();!(m=(S=P.next()).done);m=!0){var O=S.value;v.index++;var j=t(O,v),k=v.index;for(var A in n=j[0],a=j[1],o[2*k]=n,o[2*k+1]=a,s[2*k]=x(n),s[2*k+1]=x(a),i){var D=i[A].getWeight(O);Array.isArray(D)?(d[A].values[3*k]=D[0],d[A].values[3*k+1]=D[1],d[A].values[3*k+2]=D[2]):d[A].values[3*k]=D}Number.isFinite(a)&&Number.isFinite(n)&&(l=a<l?a:l,u=a>u?a:u,c=n<c?n:c,g=n>g?n:g)}}catch(e){M=!0,C=e}finally{try{m||null==P.return||P.return()}finally{if(M)throw C}}var _={xMin:w(c),xMax:w(g),yMin:w(l),yMax:w(u)};return{positions:o,positions64xyLow:s,weights:d,boundingBox:_}}(t,i,s)).boundingBox);var P=[a,a],O=[0,0];switch(d.a.assert(g===m.a.LNGLAT||g===m.a.IDENTITY),g){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var j=function(e,t){var i=e.yMin,a=e.yMax;return function(e,t){var i=(o=e,o/6378e3*(180/Math.PI)),a=(n=t,r=e,r/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180));var n,r;var o;return{yOffset:i,xOffset:a}}(t,(i+a)/2)}(M,a);P=[j.xOffset,j.yOffset],O=[-180,-90];break;case m.a.IDENTITY:O=[-p.width/2,-p.height/2];break;default:d.a.assert(!1)}var k=function(e){var t=e.boundingBox,i=e.cellSize,a=e.worldOrigin,n=t.yMin,r=t.yMax,o=t.xMin,s=t.xMax,l=C(o-a[0],i[0])+a[0],u=C(n-a[1],i[1])+a[1],c=(new f.a).translate([-1*l,-1*u,0]),g=[l,u],d=s-o+i[0],h=r-n+i[1],p=[Math.ceil(d/i[0]),Math.ceil(h/i[1])];return{gridOrigin:g,gridSize:p,width:d,height:h,gridTransformMatrix:c}}({boundingBox:M,cellSize:P,worldOrigin:O});return{weights:n.run({positions:S.positions,positions64xyLow:S.positions64xyLow,weights:S.weights,cellSize:P,width:k.width,height:k.height,gridTransformMatrix:k.gridTransformMatrix,useGPU:r,changeFlags:o,fp64:u}),gridSize:k.gridSize,gridOrigin:k.gridOrigin,cellSize:P,boundingBox:M}}function C(e,t){var i=e<0?-1:1,a=i<0?Math.abs(e)+t:Math.abs(e);return(a=Math.floor(a/t)*t)*i}var S=i(4619),P=i(4636),O=i(4836),j=i(1504),k=i(4733),A=i(5024),D=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),_=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),F=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),z=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),E={POSITION:{size:3,value:new Float32Array(_)},NORMAL:{size:3,value:new Float32Array(F)},TEXCOORD_0:{size:2,value:new Float32Array(z)}},L=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)(this,t);var i=e.id,n=void 0===i?Object(A.c)(\"cube-geometry\"):i;return Object(r.a)(this,Object(o.a)(t).call(this,Object(j.a)({},e,{id:n,indices:{size:1,value:new Uint16Array(D)},attributes:Object(j.a)({},E,e.attributes)})))}return Object(s.a)(t,e),t}(k.a),R=p.a.fp64LowPart,T=new g.a,N={colorDomain:null,colorRange:S.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:\"number\",min:0,value:1},gridSize:{type:\"array\",min:0,value:[1,1]},gridOrigin:{type:\"array\",min:0,value:[0,0]},gridOffset:{type:\"array\",min:0,value:[0,0]},cellSize:{type:\"number\",min:0,max:1e3,value:1e3},offset:{type:\"array\",min:0,value:[1,1]},coverage:{type:\"number\",min:0,max:1,value:1},extruded:!0,fp64:!1,material:T},I=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(n.a)(t,[{key:\"getShaders\",value:function(){return{vs:\"#version 300 es\\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\\n#define RANGE_COUNT 6\\n\\nin vec3 positions;\\nin vec3 normals;\\n\\nin vec4 colors;\\nin vec4 elevations;\\nin vec3 instancePickingColors;\\nuniform vec2 offset;\\nuniform bool extruded;\\nuniform float cellSize;\\nuniform float coverage;\\nuniform float opacity;\\nuniform float elevationScale;\\n\\nuniform ivec2 gridSize;\\nuniform vec2 gridOrigin;\\nuniform vec2 gridOriginLow;\\nuniform vec2 gridOffset;\\nuniform vec2 gridOffsetLow;\\nuniform vec4 colorRange[RANGE_COUNT];\\nuniform vec2 elevationRange;\\nuniform vec2 colorDomain;\\nuniform bool colorDomainValid;\\nuniform vec2 elevationDomain;\\nuniform bool elevationDomainValid;\\n\\nlayout(std140) uniform;\\nuniform ColorData\\n{\\n  vec4 maxMinCount;\\n} colorData;\\nuniform ElevationData\\n{\\n  vec4 maxMinCount;\\n} elevationData;\\n\\n#define EPSILON 0.00001\\nout vec4 vColor;\\n\\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\\n  vec4 outColor = vec4(0., 0., 0., 0.);\\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\\n    float domainRange = domain.y - domain.x;\\n    if (domainRange <= 0.) {\\n      outColor = colorRange[0];\\n    } else {\\n      float rangeCount = float(RANGE_COUNT);\\n      float rangeStep = domainRange / rangeCount;\\n      float idx = floor((value - domain.x) / rangeStep);\\n      idx = clamp(idx, 0., rangeCount - 1.);\\n      int intIdx = int(idx);\\n      outColor = colorRange[intIdx];\\n    }\\n  }\\n  return outColor;\\n}\\n\\nfloat linearScale(vec2 domain, vec2 range, float value) {\\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\\n  }\\n  return -1.;\\n}\\n\\nvoid main(void) {\\n\\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\\n\\n  float elevation = 0.0;\\n\\n  if (extruded) {\\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\\n  }\\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\\n\\n  int yIndex = (gl_InstanceID / gridSize[0]);\\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\\n\\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\\n\\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\\n  picking_setPickingColor(instancePickingColors);\\n\\n  vec4 position_commonspace;\\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\\n\\n  vec3 normals_commonspace = project_normal(normals);\\n\\n   if (extruded) {\\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\\n  } else {\\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\\n  }\\n}\\n\",fs:\"#version 300 es\\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\\n\\nprecision highp float;\\n\\nin vec4 vColor;\\n\\nout vec4 fragColor;\\n\\nvoid main(void) {\\n  fragColor = vColor;\\n  fragColor = picking_filterColor(fragColor);\\n}\\n\",modules:[\"project32\",\"gouraud-lighting\",\"picking\",\"fp64\"]}}},{key:\"initializeState\",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:\"_getModel\",value:function(e){return new O.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new L,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:\"draw\",value:function(e){var t=e.uniforms,i=this.props,a=i.data,n=i.cellSize,r=i.offset,o=i.extruded,s=i.elevationScale,l=i.coverage,u=i.gridSize,c=i.gridOrigin,g=i.gridOffset,d=i.colorRange,h=i.elevationRange,f=[R(c[0]),R(c[1])],p=[R(g[0]),R(g[1])],v=a.color.maxMinBuffer,m=a.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var b=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,b,{cellSize:n,offset:r,extruded:o,elevationScale:s,coverage:l,gridSize:u,gridOrigin:c,gridOriginLow:f,gridOffset:g,gridOffsetLow:p,colorRange:d,elevationRange:h})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:\"calculateColors\",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:\"calculateElevations\",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:\"getDomainUniforms\",value:function(){var e=this.props,t=e.colorDomain,i=e.elevationDomain,a={};return null!==t?(a.colorDomainValid=!0,a.colorDomain=t):a.colorDomainValid=!1,null!==i?(a.elevationDomainValid=!0,a.elevationDomain=i):a.elevationDomainValid=!1,a}},{key:\"_setupUniformBuffer\",value:function(e){var t=this.context.gl,i=e.program.handle,a=t.getUniformBlockIndex(i,\"ColorData\"),n=t.getUniformBlockIndex(i,\"ElevationData\");t.uniformBlockBinding(i,a,0),t.uniformBlockBinding(i,n,1)}}]),t}(P.a);I.layerName=\"GPUGridCellLayer\",I.defaultProps=N;var B=i(7);function U(e,t,i){var a=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=1/0,r=-1/0,o=Object(b.a)(t),s=o.iterable,l=o.objectInfo,u=!0,c=!1,g=void 0;try{for(var d,h=s[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value;l.index++,e=a(f,l)[1],Number.isFinite(e)&&(n=e<n?e:n,r=e>r?e:r)}}catch(e){c=!0,g=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw g}}var p=(n+r)/2,v=V(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var y=!0,x=!1,w=void 0;try{for(var M,C=s[Symbol.iterator]();!(y=(M=C.next()).done);y=!0){var S=M.value;l.index++;var P=a(S,l),O=Object(B.a)(P,2),j=O[0],k=O[1];if(Number.isFinite(k)&&Number.isFinite(j)){var A=Math.floor((k+90)/v.yOffset),D=Math.floor((j+180)/v.xOffset),_=\"\".concat(A,\"-\").concat(D);m[_]=m[_]||{count:0,points:[]},m[_].count+=1,m[_].points.push(S)}}}catch(e){x=!0,w=e}finally{try{y||null==C.return||C.return()}finally{if(x)throw w}}return{gridHash:m,gridOffset:v}}(e,t,i),n=a.gridHash,r=a.gridOffset;return{gridHash:n,gridOffset:r,layerData:function(e,t){return Object.keys(e).reduce((function(i,a,n){var r=a.split(\"-\"),o=parseInt(r[0],10),s=parseInt(r[1],10);return i.push(Object.assign({index:n,position:[t.xOffset*s-180,t.yOffset*o-90]},e[a])),i}),[])}(n,r)}}function V(e,t){var i;return{yOffset:e/6378e3*(180/Math.PI),xOffset:(i=t,e/6378e3*(180/Math.PI)/Math.cos(i*Math.PI/180))}}var G=new g.a,W={colorDomain:null,colorRange:S.b,getColorWeight:{type:\"accessor\",value:function(e){return 1}},colorAggregation:\"SUM\",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:\"accessor\",value:function(e){return 1}},elevationAggregation:\"SUM\",elevationScale:{type:\"number\",min:0,value:1},cellSize:{type:\"number\",min:0,max:1e3,value:1e3},coverage:{type:\"number\",min:0,max:1,value:1},getPosition:{type:\"accessor\",value:function(e){return e.position}},extruded:!1,fp64:!1,material:G,gpuAggregation:!0},q=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(n.a)(t,[{key:\"initializeState\",value:function(){var e=this.context.gl,t=u.a.isSupported(e);t||d.a.error(\"GPUGridLayer is not supported on this browser, use GridLayer instead\")();var i={id:\"\".concat(this.id,\"-gpu-aggregator\"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new u.a(e,i),isSupported:t}}},{key:\"updateState\",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:\"finalizeState\",value:function(){Object(c.a)(Object(o.a)(t.prototype),\"finalizeState\",this).call(this),this.state.gpuGridAggregator.delete()}},{key:\"getAggregationFlags\",value:function(e){var t=e.oldProps,i=e.props,a=e.changeFlags,n=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:i,changeFlags:a})&&(n=Object.assign({},n,{dataChanged:!0})),t.cellSize!==i.cellSize&&(n=Object.assign({},n,{cellSizeChanged:!0})),n)}},{key:\"isDataChanged\",value:function(e){var t=e.oldProps,i=e.props,a=e.changeFlags;return!!a.dataChanged||(t.gpuAggregation!==i.gpuAggregation||(t.colorAggregation!==i.colorAggregation||t.elevationAggregation!==i.elevationAggregation||!(!a.updateTriggersChanged||!(a.updateTriggersChanged.all||a.updateTriggersChanged.getPosition||a.updateTriggersChanged.getColorWeight||a.updateTriggersChanged.getElevationWeight))))}},{key:\"getHashKeyForIndex\",value:function(e){var t=this.state,i=t.gridSize,a=t.gridOrigin,n=t.cellSize,r=Math.floor(e/i[0]),o=e-r*i[0],s=Math.floor((r*n[1]+a[1]+90+n[1]/2)/n[1]),l=Math.floor((o*n[0]+a[0]+180+n[0]/2)/n[0]);return\"\".concat(s,\"-\").concat(l)}},{key:\"getPositionForIndex\",value:function(e){var t=this.state,i=t.gridSize,a=t.gridOrigin,n=t.cellSize,r=Math.floor(e/i[0]),o=e-r*i[0],s=r*n[1]+a[1];return[o*n[0]+a[0],s]}},{key:\"getPickingInfo\",value:function(e){var t=e.info,i=e.mode,a=t.index,n=null;if(a>=0){var r=this.state.gpuGridAggregator,o=this.getPositionForIndex(a),s=u.a.getAggregationData(Object.assign({pixelIndex:a},r.getData(\"color\"))),l=u.a.getAggregationData(Object.assign({pixelIndex:a},r.getData(\"elevation\")));if(n={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:o,totalCount:s.totalCount||l.totalCount},\"hover\"!==i){var c=this.props,g=c.data,d=c.getPosition,h=this.state.gridHash;if(!h)h=U(g,this.props.cellSize,d).gridHash,this.setState({gridHash:h});var f=h[this.getHashKeyForIndex(a)];Object.assign(n,f)}}return Object.assign(t,{picked:Boolean(n),object:n})}},{key:\"getLayerData\",value:function(e){var t=this.props,i=t.data,a=t.cellSize,n=t.getPosition,r=t.gpuAggregation,o=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,u=t.elevationAggregation,c=t.fp64,g=M({data:i,cellSizeMeters:a,getPosition:n,weightParams:{color:{getWeight:o,operation:h.a[s]||h.a[W.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:h.a[u]||h.a[W.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:r,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:c}),d=g.weights,f=g.gridSize,p=g.gridOrigin,v=g.cellSize,m=g.boundingBox;this.setState({weights:d,gridSize:f,gridOrigin:p,cellSize:v,boundingBox:m})}},{key:\"renderLayers\",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,i=e.fp64,a=e.extruded,n=e.cellSize,r=e.coverage,o=e.material,s=e.elevationRange,l=e.colorDomain,u=e.elevationDomain,c=this.state,g=c.weights,d=c.gridSize,h=c.gridOrigin,f=c.cellSize,p=Object(S.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass(\"gpu-grid-cell\",I))({gridSize:d,gridOrigin:h,gridOffset:f,colorRange:p,elevationRange:s,colorDomain:l,elevationDomain:u,fp64:i,cellSize:n,coverage:r,material:o,elevationScale:t,extruded:a},this.getSubLayerProps({id:\"gpu-grid-cell\"}),{data:g,numInstances:d[0]*d[1]})}}]),t}(l.a);q.layerName=\"GPUGridLayer\",q.defaultProps=W;var X=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(n.a)(t,[{key:\"getGeometry\",value:function(e){return new L}},{key:\"draw\",value:function(e){var t=e.uniforms,i=this.props,a=i.elevationScale,n=i.extruded,r=i.offset,o=i.coverage,s=i.cellSize,l=i.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:r,extruded:n,coverage:o,elevationScale:a,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(i(4703).a);X.layerName=\"GridCellLayer\",X.defaultProps={cellSize:{type:\"number\",min:0,value:1e3},offset:{type:\"array\",min:0,value:[1,1]}};var Y=i(4651),H=i(4652);function K(){}var Z=new g.a,J={colorDomain:null,colorRange:S.b,getColorValue:{type:\"accessor\",value:null},getColorWeight:{type:\"accessor\",value:function(e){return 1}},colorAggregation:\"SUM\",lowerPercentile:{type:\"number\",min:0,max:100,value:0},upperPercentile:{type:\"number\",min:0,max:100,value:100},onSetColorDomain:K,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:\"accessor\",value:null},getElevationWeight:{type:\"accessor\",value:function(e){return 1}},elevationAggregation:\"SUM\",elevationLowerPercentile:{type:\"number\",min:0,max:100,value:0},elevationUpperPercentile:{type:\"number\",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:K,cellSize:{type:\"number\",min:0,max:1e3,value:1e3},coverage:{type:\"number\",min:0,max:1,value:1},getPosition:{type:\"accessor\",value:function(e){return e.position}},extruded:!1,fp64:!1,material:Z},Q=[\"getColorValue\",\"colorAggregation\",\"getColorWeight\"],$=[\"getElevationValue\",\"elevationAggregation\",\"getElevationWeight\"],ee=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(n.a)(t,[{key:\"initializeState\",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:K,elevationScaleFunc:K,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:\"updateState\",value:function(e){var t=this,i=e.oldProps,a=e.props,n=e.changeFlags;this.updateGetValueFuncs(i,a);var r=this.needsReProjectPoints(i,a,n);n.dataChanged||r?this.getLayerData():(this.getDimensionChanges(i,a)||[]).forEach((function(e){return\"function\"==typeof e&&e.apply(t)}))}},{key:\"colorElevationPropsChanged\",value:function(e,t){for(var i=!1,a=!1,n=0;n<Q.length;n++){var r=Q[n];e[r]!==t[r]&&(i=!0)}for(var o=0;o<$.length;o++){var s=$[o];e[s]!==t[s]&&(a=!0)}return{colorChanged:i,elevationChanged:a}}},{key:\"updateGetValueFuncs\",value:function(e,t){var i=t.getColorValue,a=t.getElevationValue,n=this.props,r=n.colorAggregation,o=n.getColorWeight,s=n.elevationAggregation,l=n.getElevationWeight,u=this.colorElevationPropsChanged(e,t),c=u.colorChanged,g=u.elevationChanged;c&&null===i&&(i=Object(h.b)(r,o)),g&&null===a&&(a=Object(h.b)(s,l)),i&&this.setState({getColorValue:i}),a&&this.setState({getElevationValue:a})}},{key:\"needsReProjectPoints\",value:function(e,t,i){return e.cellSize!==t.cellSize||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}},{key:\"getDimensionUpdaters\",value:function(){return{getFillColor:[{id:\"value\",triggers:[\"getColorValue\",\"getColorWeight\",\"colorAggregation\"],updater:this.getSortedColorBins},{id:\"domain\",triggers:[\"lowerPercentile\",\"upperPercentile\"],updater:this.getColorValueDomain},{id:\"scaleFunc\",triggers:[\"colorDomain\",\"colorRange\"],updater:this.getColorScale}],getElevation:[{id:\"value\",triggers:[\"getElevationValue\",\"getElevationWeight\",\"elevationAggregation\"],updater:this.getSortedElevationBins},{id:\"domain\",triggers:[\"elevationLowerPercentile\",\"elevationUpperPercentile\"],updater:this.getElevationValueDomain},{id:\"scaleFunc\",triggers:[\"elevationDomain\",\"elevationRange\"],updater:this.getElevationScale}]}}},{key:\"getDimensionChanges\",value:function(e,t){var i=this.state.dimensionUpdaters,a=[];for(var n in i){var r=i[n].find((function(i){return i.triggers.some((function(i){return e[i]!==t[i]}))}));r&&a.push(r.updater)}return a.length?a:null}},{key:\"getPickingInfo\",value:function(e){var t=e.info,i=this.state,a=i.sortedColorBins,n=i.sortedElevationBins,r=null;if(t.picked&&t.index>-1){var o=this.state.layerData[t.index],s=a.binMap[o.index]&&a.binMap[o.index].value,l=n.binMap[o.index]&&n.binMap[o.index].value;r=Object.assign({colorValue:s,elevationValue:l},o)}return Object.assign(t,{picked:Boolean(r),object:r})}},{key:\"getUpdateTriggers\",value:function(){var e=this,t=this.state.dimensionUpdaters,i={},a=function(a){i[a]={};var n=!0,r=!1,o=void 0;try{for(var s,l=t[a][Symbol.iterator]();!(n=(s=l.next()).done);n=!0){s.value.triggers.forEach((function(t){i[a][t]=e.props[t]}))}}catch(e){r=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}};for(var n in t)a(n);return i}},{key:\"getLayerData\",value:function(){var e=this.props,t=U(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:\"getValueDomain\",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:\"getSortedBins\",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:\"getSortedColorBins\",value:function(){var e=this.state.getColorValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:\"getSortedElevationBins\",value:function(){var e=this.state.getElevationValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:\"getColorValueDomain\",value:function(){var e=this.props,t=e.lowerPercentile,i=e.upperPercentile,a=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,i]),\"function\"==typeof a&&a(this.state.colorValueDomain),this.getColorScale()}},{key:\"getElevationValueDomain\",value:function(){var e=this.props,t=e.elevationLowerPercentile,i=e.elevationUpperPercentile,a=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,i]),\"function\"==typeof a&&a(this.state.elevationValueDomain),this.getElevationScale()}},{key:\"getColorScale\",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(H.b)(t,e)}},{key:\"getElevationScale\",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(H.a)(t,e)}},{key:\"_onGetSublayerColor\",value:function(e){var t=this.state,i=t.sortedColorBins,a=t.colorScaleFunc,n=t.colorValueDomain,r=i.binMap[e.index]&&i.binMap[e.index].value,o=this.props.colorDomain||n,s=r>=o[0]&&r<=o[o.length-1]?a(r):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:\"_onGetSublayerElevation\",value:function(e){var t=this.state,i=t.sortedElevationBins,a=t.elevationScaleFunc,n=t.elevationValueDomain,r=i.binMap[e.index]&&i.binMap[e.index].value,o=this.props.elevationDomain||n;return r>=o[0]&&r<=o[o.length-1]?a(r):-1}},{key:\"renderLayers\",value:function(){var e=this.props,t=e.elevationScale,i=e.fp64,a=e.extruded,n=e.cellSize,r=e.coverage,o=e.material,s=e.transitions;return new(this.getSubLayerClass(\"grid-cell\",X))({fp64:i,cellSize:n,coverage:r,material:o,elevationScale:t,extruded:a,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:\"grid-cell\",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);ee.layerName=\"CPUGridLayer\",ee.defaultProps=J;var te=Object.assign({},q.defaultProps,ee.defaultProps,{gpuAggregation:!1}),ie=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(n.a)(t,[{key:\"initializeState\",value:function(){this.state={useGPUAggregation:!0}}},{key:\"updateState\",value:function(e){e.oldProps;var t=e.props,i=(e.changeFlags,{});i.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(i)}},{key:\"renderLayers\",value:function(){var e=this.props,t=e.data,i=e.updateTriggers,a=this.state.useGPUAggregation?\"GPU\":\"CPU\";return new(this.state.useGPUAggregation?this.getSubLayerClass(\"GPU\",q):this.getSubLayerClass(\"CPU\",ee))(this.props,this.getSubLayerProps({id:a,updateTriggers:i}),{data:t})}},{key:\"canUseGPUAggregation\",value:function(e){var t=e.gpuAggregation,i=e.lowerPercentile,a=e.upperPercentile,n=e.getColorValue,r=e.getElevationValue;return!!t&&(!!u.a.isSupported(this.context.gl)&&(0===i&&100===a&&(null===n&&null===r)))}}]),t}(l.a);ie.layerName=\"GridLayer\",ie.defaultProps=te;var ae=i(0),ne=i.n(ae),re=i(20),oe=i(4608),se=i(4602),le=i(4614),ue=i(4609);function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function ge(e){return ne.a.createElement(\"div\",{className:\"deckgl-tooltip\"},ne.a.createElement(ue.a,{label:Object(re.e)(\"Longitude and Latitude\")+\": \",value:e.coordinate[0]+\", \"+e.coordinate[1]}),ne.a.createElement(ue.a,{label:Object(re.e)(\"Height\")+\": \",value:\"\"+e.object.elevationValue}))}function de(e,t,i,a){const n=e,r=n.color_picker;let o=t.data.features.map(e=>ce({},e,{color:[r.r,r.g,r.b,255*r.a]}));if(n.js_data_mutator){o=Object(se.a)(n.js_data_mutator)(o)}const s=Object(oe.b)(n.js_agg_function,e=>e.weight);return new ie(ce({id:\"grid-layer-\"+n.slice_id,data:o,pickable:!0,cellSize:n.grid_size,minColor:[0,0,0,0],extruded:n.extruded,maxColor:[r.r,r.g,r.b,255*r.a],outline:!1,getElevationValue:s,getColorValue:s},Object(oe.a)(n,a,ge)))}t.default=Object(le.b)(de,(function(e){return e.map(e=>e.position)}))}}]);","extractedComments":[]}