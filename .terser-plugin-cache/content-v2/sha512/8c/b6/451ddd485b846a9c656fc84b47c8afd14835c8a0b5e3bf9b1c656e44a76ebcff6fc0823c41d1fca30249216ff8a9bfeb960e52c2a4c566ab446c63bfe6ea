{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{165:function(e,t,a){\"use strict\";a.d(t,\"c\",(function(){return s})),a.d(t,\"f\",(function(){return r})),a.d(t,\"b\",(function(){return c})),a.d(t,\"a\",(function(){return n})),a.d(t,\"g\",(function(){return l})),a.d(t,\"d\",(function(){return i})),a.d(t,\"e\",(function(){return o}));const s=\"YYYY-MM-DD HH:mm:ssZ\",r=\"HH:mm:ss.SSS\",c=\"True\",n=\"False\",l={standalone:\"standalone\",preselectFilters:\"preselect_filters\"},i=250,o=500},4923:function(e,t,a){\"use strict\";a.r(t);a(33);var s,r=a(0),c=a.n(r),n=a(52),l=a(20),i=a(67),o=a(32),d=a.n(o),u=a(138),b=a(122),m=a(524),h=a(977),p=a(26),f=a(4514),O=a(4477),g=a(45),j=a(51),y=a(495),q=a.n(y),_=a(909),x=a.n(_),w=a(791),v=a.n(w),S=a(165);!function(e){e.id=\"id\",e.changed_on=\"changed_on\",e.database=\"database\",e.database_name=\"database.database_name\",e.schema=\"schema\",e.sql=\"sql\",e.executed_sql=\"exceuted_sql\",e.sql_tables=\"sql_tables\",e.status=\"status\",e.tab_name=\"tab_name\",e.user=\"user\",e.user_first_name=\"user.first_name\",e.start_time=\"start_time\",e.end_time=\"end_time\",e.rows=\"rows\",e.tmp_table_name=\"tmp_table_name\",e.tracking_url=\"tracking_url\"}(s||(s={}));var $=a(100),k=a(6),H=a.n(k),z=a(41),C=a(4687),D=a(4688),T=a(1);const L=n.c.div`\n  color: ${({theme:e})=>e.colors.secondary.light2};\n  font-size: ${({theme:e})=>e.typography.sizes.s-1}px;\n  margin-bottom: 0;\n  text-transform: uppercase;\n`,U=n.c.div`\n  color: ${({theme:e})=>e.colors.grayscale.dark2};\n  font-size: ${({theme:e})=>e.typography.sizes.m-1}px;\n  padding: 4px 0 24px 0;\n`,A=n.c.div`\n  margin: 0 0 ${({theme:e})=>6*e.gridUnit}px 0;\n`,F=n.c.div`\n  display: inline;\n  font-size: ${({theme:e})=>e.typography.sizes.s}px;\n  padding: ${({theme:e})=>2*e.gridUnit}px\n    ${({theme:e})=>4*e.gridUnit}px;\n  margin-right: ${({theme:e})=>4*e.gridUnit}px;\n  color: ${({theme:e})=>e.colors.secondary.dark1};\n\n  &.active,\n  &:focus,\n  &:hover {\n    background: ${({theme:e})=>e.colors.secondary.light4};\n    border-bottom: none;\n    border-radius: ${({theme:e})=>e.borderRadius}px;\n    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;\n  }\n\n  &:hover:not(.active) {\n    background: ${({theme:e})=>e.colors.secondary.light5};\n  }\n`,I=Object(n.c)($.b)`\n  .ant-modal-body {\n    padding: ${({theme:e})=>6*e.gridUnit}px;\n  }\n\n  pre {\n    font-size: ${({theme:e})=>e.typography.sizes.xs}px;\n    font-weight: ${({theme:e})=>e.typography.weights.normal};\n    line-height: ${({theme:e})=>e.typography.sizes.l}px;\n    height: 375px;\n    border: none;\n  }\n`;var Q=Object(b.a)((function({onHide:e,openInSqlLab:t,queries:a,query:s,fetchData:c,show:n,addDangerToast:i,addSuccessToast:o}){const{handleKeyPress:d,handleDataChange:u,disablePrevious:b,disableNext:m}=Object(D.a)({queries:a,currentQueryId:s.id,fetchData:c}),[h,p]=Object(r.useState)(\"user\"),{id:f,sql:O,executed_sql:g}=s;return Object(T.f)(\"div\",{role:\"none\",onKeyUp:d},Object(T.f)(I,{onHide:e,show:n,title:Object(l.e)(\"Query preview\"),footer:[Object(T.f)(z.a,{key:\"previous-query\",disabled:b,onClick:()=>u(!0)},Object(l.e)(\"Previous\")),Object(T.f)(z.a,{key:\"next-query\",disabled:m,onClick:()=>u(!1)},Object(l.e)(\"Next\")),Object(T.f)(z.a,{key:\"open-in-sql-lab\",buttonStyle:\"primary\",onClick:()=>t(f)},Object(l.e)(\"Open in SQL Lab\"))]},Object(T.f)(L,null,Object(l.e)(\"Tab name\")),Object(T.f)(U,null,s.tab_name),Object(T.f)(A,null,Object(T.f)(F,{role:\"button\",className:H()({active:\"user\"===h}),onClick:()=>p(\"user\")},Object(l.e)(\"User query\")),Object(T.f)(F,{role:\"button\",className:H()({active:\"executed\"===h}),onClick:()=>p(\"executed\")},Object(l.e)(\"Executed query\"))),Object(T.f)(C.a,{addDangerToast:i,addSuccessToast:o,language:\"sql\"},(\"user\"===h?O:g)||\"\")))}));const M=Object(n.c)(O.b)`\n  table .table-cell {\n    vertical-align: top;\n  }\n`;q.a.registerLanguage(\"sql\",x.a);const N=Object(n.c)(q.a)`\n  height: ${({theme:e})=>26*e.gridUnit}px;\n  overflow: hidden !important; /* needed to override inline styles */\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`,B=n.c.div`\n  .count {\n    margin-left: 5px;\n    color: ${({theme:e})=>e.colors.primary.base};\n    text-decoration: underline;\n    cursor: pointer;\n  }\n`,P=n.c.div`\n  color: ${({theme:e})=>e.colors.grayscale.dark2};\n`,R=Object(n.c)(g.a,{shouldForwardProp:e=>\"status\"!==e})`\n  color: ${({status:e,theme:t})=>\"success\"===e?t.colors.success.base:\"failed\"===e?t.colors.error.base:\"running\"===e?t.colors.primary.base:\"offline\"===e?t.colors.grayscale.light1:t.colors.grayscale.base};\n`;t.default=Object(b.a)((function({addDangerToast:e,addSuccessToast:t}){const{state:{loading:a,resourceCount:n,resourceCollection:o},fetchData:b}=Object(m.e)(\"query\",Object(l.e)(\"Query history\"),e,!1),[y,q]=Object(r.useState)(),_=Object(r.useCallback)(t=>{i.a.get({endpoint:\"/api/v1/query/\"+t}).then(({json:e={}})=>{q({...e.result})},Object(u.c)(t=>e(Object(l.e)(\"There was an issue previewing the selected query. %s\",t))))},[e]),x={activeChild:\"Query history\",...f.a},w=[{id:s.start_time,desc:!0}],$=Object(r.useMemo)(()=>[{Cell:({row:{original:{status:e}}})=>{const t={name:\"\",label:\"\",status:\"\"};return\"success\"===e&&(t.name=\"check\",t.label=Object(l.e)(\"Success\"),t.status=\"success\"),\"failed\"!==e&&\"stopped\"!==e||(t.name=\"x-small\",t.label=Object(l.e)(\"Failed\"),t.status=\"failed\"),\"running\"===e&&(t.name=\"running\",t.label=Object(l.e)(\"Running\"),t.status=\"running\"),\"timed_out\"===e&&(t.name=\"offline\",t.label=Object(l.e)(\"Offline\"),t.status=\"offline\"),\"scheduled\"!==e&&\"pending\"!==e||(t.name=\"queued\",t.label=Object(l.e)(\"Scheduled\"),t.status=\"queued\"),Object(T.f)(j.a,{title:t.label,placement:\"bottom\"},Object(T.f)(\"span\",null,Object(T.f)(R,{name:t.name,status:t.status})))},accessor:s.status,size:\"xs\",disableSortBy:!0},{accessor:s.start_time,Header:Object(l.e)(\"Time\"),size:\"xl\",Cell:({row:{original:{start_time:e,end_time:t}}})=>{const a=d.a.utc(e).local().format(S.c).split(\" \"),s=Object(T.f)(c.a.Fragment,null,a[0],\" \",Object(T.f)(\"br\",null),a[1]);return t?Object(T.f)(j.a,{title:Object(l.e)(\"Duration: %s\",d()(d.a.utc(t-e)).format(S.f)),placement:\"bottom\"},Object(T.f)(\"span\",null,s)):s}},{accessor:s.tab_name,Header:Object(l.e)(\"Tab name\"),size:\"xl\"},{accessor:s.database_name,Header:Object(l.e)(\"Database\"),size:\"xl\"},{accessor:s.database,hidden:!0},{accessor:s.schema,Header:Object(l.e)(\"Schema\"),size:\"xl\"},{Cell:({row:{original:{sql_tables:e=[]}}})=>{const t=e.map(e=>e.table),a=t.length>0?t.shift():\"\";return t.length?Object(T.f)(B,null,Object(T.f)(\"span\",null,a),Object(T.f)(p.r,{placement:\"right\",title:Object(l.e)(\"TABLES\"),trigger:\"click\",content:Object(T.f)(c.a.Fragment,null,t.map(e=>Object(T.f)(P,{key:e},e)))},Object(T.f)(\"span\",{className:\"count\"},\"(+\",t.length,\")\"))):a},accessor:s.sql_tables,Header:Object(l.e)(\"Tables\"),size:\"xl\",disableSortBy:!0},{accessor:s.user_first_name,Header:Object(l.e)(\"User\"),size:\"xl\",Cell:({row:{original:{user:e}}})=>`${e.first_name} ${e.last_name}`},{accessor:s.user,hidden:!0},{accessor:s.rows,Header:Object(l.e)(\"Rows\"),size:\"md\"},{accessor:s.sql,Header:Object(l.e)(\"SQL\"),Cell:({row:{original:e,id:t}})=>Object(T.f)(\"div\",{tabIndex:0,role:\"button\",onClick:()=>q(e)},Object(T.f)(N,{language:\"sql\",style:v.a},Object(u.l)(e.sql,4)))},{Header:Object(l.e)(\"Actions\"),id:\"actions\",disableSortBy:!0,Cell:({row:{original:{id:e}}})=>Object(T.f)(j.a,{title:Object(l.e)(\"Open query in SQL Lab\"),placement:\"bottom\"},Object(T.f)(\"a\",{href:\"/superset/sqllab?queryId=\"+e},Object(T.f)(g.a,{name:\"full\"})))}],[]),k=Object(r.useMemo)(()=>[{Header:Object(l.e)(\"Database\"),id:\"database\",input:\"select\",operator:O.a.relationOneMany,unfilteredLabel:\"All\",fetchSelects:Object(u.e)(\"query\",\"database\",Object(u.c)(t=>e(Object(l.e)(\"An error occurred while fetching database values: %s\",t)))),paginate:!0},{Header:Object(l.e)(\"State\"),id:\"status\",input:\"select\",operator:O.a.equals,unfilteredLabel:\"All\",fetchSelects:Object(u.d)(\"query\",\"status\",Object(u.c)(t=>e(Object(l.e)(\"An error occurred while fetching schema values: %s\",t)))),paginate:!0},{Header:Object(l.e)(\"User\"),id:\"user\",input:\"select\",operator:O.a.relationOneMany,unfilteredLabel:\"All\",fetchSelects:Object(u.e)(\"query\",\"user\",Object(u.c)(t=>e(Object(l.e)(\"An error occurred while fetching database values: %s\",t)))),paginate:!0},{Header:Object(l.e)(\"Time range\"),id:\"start_time\",input:\"datetime_range\",operator:O.a.between},{Header:Object(l.e)(\"Search by query text\"),id:\"sql\",input:\"search\",operator:O.a.contains}],[e]);return Object(T.f)(c.a.Fragment,null,Object(T.f)(h.a,x),y&&Object(T.f)(Q,{onHide:()=>q(void 0),query:y,queries:o,fetchData:_,openInSqlLab:e=>window.location.assign(\"/superset/sqllab?queryId=\"+e),show:!0}),Object(T.f)(M,{className:\"query-history-list-view\",columns:$,count:n,data:o,fetchData:b,filters:k,initialSort:w,loading:a,pageSize:25,highlightRowId:null==y?void 0:y.id}))}))}}]);","extractedComments":[]}